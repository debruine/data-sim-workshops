<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calorie Placement Re-Simulation • dsw</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calorie Placement Re-Simulation">
<meta property="og:description" content="dsw">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsw</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calories.html">Calorie Placement Re-Simulation</a>
    </li>
    <li>
      <a href="../articles/faux.html">Intro to Faux</a>
    </li>
    <li>
      <a href="../articles/fixed.html">Fixed Effects</a>
    </li>
    <li>
      <a href="../articles/mixed.html">Mixed Effects</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/debruine/data-sim-workshop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calorie Placement Re-Simulation</h1>
                        <h4 data-toc-skip class="author">Lisa
DeBruine</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/debruine/data-sim-workshop/blob/HEAD/vignettes/calories.Rmd" class="external-link"><code>vignettes/calories.Rmd</code></a></small>
      <div class="hidden name"><code>calories.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="data-source">Data Source<a class="anchor" aria-label="anchor" href="#data-source"></a>
</h2>
<p>We will be replicating some of the re-analyses in Francis &amp;
Thunell’s (2020) Meta-Psychology paper: Excess success in “Don’t count
calorie labeling out: Calorie counts on the left side of menu items lead
to lower calorie food choices”.</p>
<p>They ran power analyses for all 6 studies in Dallas, Liu, and Ubel’s
(2019) study showing that people order food with significantly fewer
calories when the calorie count was placed to the left of the item than
to the right (or having no calorie label). They then used these power
estimates to calculate the probability of all 6 out of 6 studies being
significant, given the observed power of each study.</p>
<ul>
<li><a href="https://doi.org/10.15626/MP.2019.2266" class="external-link">Re-analysis</a></li>
<li><a href="https://osf.io/xrdhj/" class="external-link">Re-analysis code</a></li>
<li><a href="https://doi.org/10.1002/jcpy.1053" class="external-link">Original paper</a></li>
</ul>
<p>Table 1 of the re-analysis paper provides all of the parameters we
will need.</p>
</div>
<div class="section level2">
<h2 id="reanalyses">Reanalyses<a class="anchor" aria-label="anchor" href="#reanalyses"></a>
</h2>
<div class="section level3">
<h3 id="study-2">Study 2<a class="anchor" aria-label="anchor" href="#study-2"></a>
</h3>
<p>We’ll start with S2 because the analysis is very straightforward.
It’s a between-subjects design, where 143 subjects saw calorie placement
on the left and their mean calories ordered were 1249.83 (SD = 449.07),
while 132 subjects saw calorie placement on the right and their mean
calories ordered were 1362.31 (SD = 447.35).</p>
<p>Let’s first simulate a single data table with these parameters and
set up our analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">1249.83</span>, right <span class="op">=</span> <span class="fl">1362.31</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">449.07</span>, right <span class="op">=</span> <span class="fl">447.35</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">143</span>, right <span class="op">=</span> <span class="fl">132</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Wrap the analysis in a function using the <code>tidy()</code>
function from {broom} to get the results in a tidy table. Check that it
works by running it on the single data set above.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2_analyse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">calories</span> <span class="op">~</span> <span class="va">placement</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">s2_analyse</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 10</span></span></span>
<span><span class="co">##   estim…¹ estim…² estim…³ stati…⁴ p.value param…⁵ conf.…⁶ conf.…⁷ method alter…⁸</span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   -<span style="color: #BB0000;">80.4</span>   <span style="text-decoration: underline;">1</span>266.   <span style="text-decoration: underline;">1</span>347.   -<span style="color: #BB0000;">1.50</span>   0.134    258.   -<span style="color: #BB0000;">186.</span>    24.9 Welch… two.si…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with abbreviated variable names ¹​estimate, ²​estimate1, ³​estimate2,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ⁴​statistic, ⁵​parameter, ⁶​conf.low, ⁷​conf.high, ⁸​alternative</span></span></span></code></pre>
<p>Now, simulate the data 500 times.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">1249.83</span>, right <span class="op">=</span> <span class="fl">1362.31</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">449.07</span>, right <span class="op">=</span> <span class="fl">447.35</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">143</span>, right <span class="op">=</span> <span class="fl">132</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>  rep <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Run the analysis on each data set.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2_sim</span> <span class="op">&lt;-</span> <span class="va">s2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>analysis <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="va">s2_analyse</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s2_sim</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">##     rep estimate estima…¹ estim…² stati…³ p.value param…⁴ conf.…⁵ conf.…⁶ method</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1   -<span style="color: #BB0000;">161.</span>     <span style="text-decoration: underline;">1</span>204.   <span style="text-decoration: underline;">1</span>365.   -<span style="color: #BB0000;">2.74</span> 6.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>    254.   -<span style="color: #BB0000;">276.</span>  -<span style="color: #BB0000;">45.2</span>  Welch…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2   -<span style="color: #BB0000;">186.</span>     <span style="text-decoration: underline;">1</span>203.   <span style="text-decoration: underline;">1</span>388.   -<span style="color: #BB0000;">3.42</span> 7.32<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>    266.   -<span style="color: #BB0000;">293.</span>  -<span style="color: #BB0000;">78.7</span>  Welch…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3   -<span style="color: #BB0000;">150.</span>     <span style="text-decoration: underline;">1</span>225.   <span style="text-decoration: underline;">1</span>375.   -<span style="color: #BB0000;">2.78</span> 5.77<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>    272.   -<span style="color: #BB0000;">256.</span>  -<span style="color: #BB0000;">43.9</span>  Welch…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4   -<span style="color: #BB0000;">130.</span>     <span style="text-decoration: underline;">1</span>275.   <span style="text-decoration: underline;">1</span>405.   -<span style="color: #BB0000;">2.39</span> 1.76<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>    272.   -<span style="color: #BB0000;">237.</span>  -<span style="color: #BB0000;">22.9</span>  Welch…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5    -<span style="color: #BB0000;">93.9</span>    <span style="text-decoration: underline;">1</span>273.   <span style="text-decoration: underline;">1</span>367.   -<span style="color: #BB0000;">1.62</span> 1.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>    269.   -<span style="color: #BB0000;">208.</span>   20.2  Welch…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6   -<span style="color: #BB0000;">116.</span>     <span style="text-decoration: underline;">1</span>235.   <span style="text-decoration: underline;">1</span>350.   -<span style="color: #BB0000;">1.99</span> 4.72<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>    272.   -<span style="color: #BB0000;">230.</span>   -<span style="color: #BB0000;">1.44</span> Welch…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 1 more variable: alternative &lt;chr&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ¹​estimate1, ²​estimate2, ³​statistic, ⁴​parameter, ⁵​conf.low, ⁶​conf.high</span></span></span></code></pre>
<p>Summarise the <code>p.value</code> column to get power.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2_power</span> <span class="op">&lt;-</span> <span class="va">s2_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sig <span class="op">=</span> <span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
<p>Compare this value (0.518) with the value in the paper (0.5426).</p>
</div>
<div class="section level3">
<h3 id="study-1">Study 1<a class="anchor" aria-label="anchor" href="#study-1"></a>
</h3>
<p>Study 1 is a little more complicated because the design includes a
“no label” condition, so the decision rule for supporting the hypothesis
is more complicated.</p>
<p>The data simulation is relatively straightforward, though.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">654.53</span>, <span class="fl">865.41</span>, <span class="fl">914.34</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">390.45</span>, <span class="fl">517.26</span>, <span class="fl">560.94</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">54</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Set up the analysis. Here, we really just care about three p-values,
so we’ll just return those. We can use a function from the {emmeans}
package to check the two pairwise comparisons.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">afex</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afex/man/set_sum_contrasts.html" class="external-link">set_sum_contrasts</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># avoids annoying afex message on each run</span></span></code></pre></div>
<pre><code><span><span class="co">## setting contr.sum globally: options(contrasts=c('contr.sum', 'contr.poly'))</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">afex_options</span><span class="op">(</span>include_aov <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># we need aov for lsmeans</span></span>
<span></span>
<span><span class="va">s1_analyse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># main effect of placement</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">afex</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afex/man/aov_car.html" class="external-link">aov_ez</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>    between <span class="op">=</span> <span class="st">"placement"</span>,</span>
<span>    data <span class="op">=</span> <span class="va">data</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># contrasts</span></span>
<span>  <span class="va">e</span> <span class="op">&lt;-</span> <span class="fu">emmeans</span><span class="op">(</span><span class="va">a</span>, <span class="st">"placement"</span><span class="op">)</span></span>
<span>  <span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>             ln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">contrast</span><span class="op">(</span><span class="va">e</span>, <span class="va">c1</span>, adjust <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    p_all <span class="op">=</span> <span class="va">a</span><span class="op">$</span><span class="va">anova_table</span><span class="op">$</span><span class="va">`Pr(&gt;F)`</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    p_1 <span class="op">=</span> <span class="va">b</span><span class="op">$</span><span class="va">adj.p.value</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    p_2 <span class="op">=</span> <span class="va">b</span><span class="op">$</span><span class="va">adj.p.value</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">s1_analyse</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         p_all        p_1         p_2</span></span>
<span><span class="co">## 1 0.006394198 0.01023146 0.006030088</span></span></code></pre>
<p>Let’s just replicate this 100 times so the simulation doesn’t take
too long to run at first. We can always increase it later after we’ve
run some sense checks.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">654.53</span>, <span class="fl">865.41</span>, <span class="fl">914.34</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">390.45</span>, <span class="fl">517.26</span>, <span class="fl">560.94</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">54</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>  rep <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Run the analysis on each data set.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1_sim</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>analysis <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="va">s1_analyse</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s1_sim</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##     rep   p_all    p_1     p_2</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 0.411   0.505  0.367  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 0.037<span style="text-decoration: underline;">8</span>  0.446  0.027<span style="text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3 0.005<span style="text-decoration: underline;">98</span> 0.102  0.002<span style="text-decoration: underline;">82</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4 0.001<span style="text-decoration: underline;">77</span> 0.473  0.001<span style="text-decoration: underline;">76</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5 0.107   0.277  0.070<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6 0.009<span style="text-decoration: underline;">38</span> 0.026<span style="text-decoration: underline;">0</span> 0.006<span style="text-decoration: underline;">10</span></span></span></code></pre>
<p>Calculating power is a little trickier here, as all three p-values
need to be significant here to support the hypothesis.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1_power</span> <span class="op">&lt;-</span> <span class="va">s1_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sig <span class="op">=</span> <span class="op">(</span><span class="va">p_all</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_1</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_2</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
<p>Compare this value (0.44) with the value in the paper (0.4582).</p>
</div>
<div class="section level3">
<h3 id="study-3">Study 3<a class="anchor" aria-label="anchor" href="#study-3"></a>
</h3>
<p>Now you can use the pattern from Study 1 to analyse the data for
Study 3. We’ll start with the repeated data set.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1428.24</span>, <span class="fl">1308.66</span>, <span class="fl">1436.79</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">377.02</span>, <span class="fl">420.14</span>, <span class="fl">378.47</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">85</span>, <span class="fl">86</span>, <span class="fl">81</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>  rep <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>These data were collected in the Hebrew language, which reads right
to left, so the paired contrasts will be different.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s3_analyse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># main effect of placement</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">afex</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afex/man/aov_car.html" class="external-link">aov_ez</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>    between <span class="op">=</span> <span class="st">"placement"</span>,</span>
<span>    data <span class="op">=</span> <span class="va">data</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># contrasts (reversed)</span></span>
<span>  <span class="va">e</span> <span class="op">&lt;-</span> <span class="fu">emmeans</span><span class="op">(</span><span class="va">a</span>, <span class="st">"placement"</span><span class="op">)</span></span>
<span>  <span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>             ln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">contrast</span><span class="op">(</span><span class="va">e</span>, <span class="va">c1</span>, adjust <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    p_all <span class="op">=</span> <span class="va">a</span><span class="op">$</span><span class="va">anova_table</span><span class="op">$</span><span class="va">`Pr(&gt;F)`</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    p_1 <span class="op">=</span> <span class="va">b</span><span class="op">$</span><span class="va">adj.p.value</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    p_2 <span class="op">=</span> <span class="va">b</span><span class="op">$</span><span class="va">adj.p.value</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run the analysis on each data set.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s3_sim</span> <span class="op">&lt;-</span> <span class="va">s3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>analysis <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="va">s3_analyse</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s3_sim</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##     rep    p_all     p_1      p_2</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 0.012<span style="text-decoration: underline;">9</span>   0.007<span style="text-decoration: underline;">95</span> 0.048<span style="text-decoration: underline;">9</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 0.000<span style="text-decoration: underline;">642</span> 0.002<span style="text-decoration: underline;">26</span> 0.000<span style="text-decoration: underline;">824</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3 0.005<span style="text-decoration: underline;">05</span>  0.004<span style="text-decoration: underline;">86</span> 0.011<span style="text-decoration: underline;">6</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4 0.000<span style="text-decoration: underline;">675</span> 0.006<span style="text-decoration: underline;">03</span> 0.000<span style="text-decoration: underline;">485</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5 0.003<span style="text-decoration: underline;">14</span>  0.007<span style="text-decoration: underline;">05</span> 0.003<span style="text-decoration: underline;">48</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6 0.046<span style="text-decoration: underline;">6</span>   0.058<span style="text-decoration: underline;">7</span>  0.058<span style="text-decoration: underline;">7</span></span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s3_power</span> <span class="op">&lt;-</span> <span class="va">s3_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sig <span class="op">=</span> <span class="op">(</span><span class="va">p_all</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_1</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_2</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
<p>Compare this value (0.37) with the value in the paper (0.3626).</p>
</div>
<div class="section level3">
<h3 id="study-s1">Study S1<a class="anchor" aria-label="anchor" href="#study-s1"></a>
</h3>
<p>Now you can use the pattern from Study 2 to analyse the data for
Study S1. You can even reuse the analysis function
<code>s2_analyse()</code>!</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss1</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">185.94</span>, right <span class="op">=</span> <span class="fl">215.73</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">93.92</span>, right <span class="op">=</span> <span class="fl">95.33</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fl">99</span>, right <span class="op">=</span> <span class="fl">77</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>  rep <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss1_sim</span> <span class="op">&lt;-</span> <span class="va">ss1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>analysis <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="va">s2_analyse</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss1_power</span> <span class="op">&lt;-</span> <span class="va">ss1_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sig <span class="op">=</span> <span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="study-s2">Study S2<a class="anchor" aria-label="anchor" href="#study-s2"></a>
</h3>
<p>Now you can use the pattern from Study 1 to analyse the data for
Study S2. You can even reuse the analysis function
<code>s1_analyse()</code>!</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss2</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1182.15</span>, <span class="fl">1302.23</span>, <span class="fl">1373.74</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">477.60</span>, <span class="fl">434.41</span>, <span class="fl">475.77</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">139</span>, <span class="fl">141</span>, <span class="fl">151</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>  rep <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss2_sim</span> <span class="op">&lt;-</span> <span class="va">ss2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>analysis <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="va">s1_analyse</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss2_power</span> <span class="op">&lt;-</span> <span class="va">ss2_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sig <span class="op">=</span> <span class="op">(</span><span class="va">p_all</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_1</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_2</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="study-s3">Study S3<a class="anchor" aria-label="anchor" href="#study-s3"></a>
</h3>
<p>Now you can use the pattern from Study 1 to analyse the data for
Study S3.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss3</span> <span class="op">&lt;-</span> <span class="fu">sim_design</span><span class="op">(</span></span>
<span>  between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1302.03</span>, <span class="fl">1373.15</span>, <span class="fl">1404.35</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">480.02</span>, <span class="fl">442.49</span>, <span class="fl">422.03</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">336</span>, <span class="fl">337</span>, <span class="fl">333</span><span class="op">)</span>,</span>
<span>  dv <span class="op">=</span> <span class="st">"calories"</span>,</span>
<span>  rep <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss3_sim</span> <span class="op">&lt;-</span> <span class="va">ss3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>analysis <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="va">s1_analyse</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss3_power</span> <span class="op">&lt;-</span> <span class="va">ss3_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sig <span class="op">=</span> <span class="op">(</span><span class="va">p_all</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_1</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>               <span class="op">(</span><span class="va">p_2</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Now that you’ve calculated power for each of the 6 studies, just
multiply the 6 power values together to get the probability that all 6
studies will be significant.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_table</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">study</span>, <span class="op">~</span><span class="va">power_ft</span>, <span class="op">~</span> <span class="va">power_my</span>,</span>
<span>  <span class="st">"1"</span>,       <span class="fl">0.4582</span>,   <span class="va">s1_power</span>,</span>
<span>  <span class="st">"2"</span>,       <span class="fl">0.5426</span>,   <span class="va">s2_power</span>,</span>
<span>  <span class="st">"3"</span>,       <span class="fl">0.3626</span>,   <span class="va">s3_power</span>,</span>
<span>  <span class="st">"S1"</span>,      <span class="fl">0.5358</span>,  <span class="va">ss1_power</span>,</span>
<span>  <span class="st">"S2"</span>,      <span class="fl">0.5667</span>,  <span class="va">ss2_power</span>,</span>
<span>  <span class="st">"S3"</span>,      <span class="fl">0.4953</span>,  <span class="va">ss3_power</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">power_table</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">##   study power_ft power_my</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1        0.458    0.44 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 2        0.543    0.518</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 3        0.363    0.37 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> S1       0.536    0.523</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> S2       0.567    0.58 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> S3       0.495    0.51</span></span></code></pre>
<p>The <code>reduce()</code> function from {purrr} applies a function
sequentially over a vector, so can give up the product of all the values
in the power columns.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob_ft</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">power_table</span><span class="op">$</span><span class="va">power_ft</span>, <span class="va">`*`</span><span class="op">)</span></span>
<span><span class="va">prob_my</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">power_table</span><span class="op">$</span><span class="va">power_my</span>, <span class="va">`*`</span><span class="op">)</span></span></code></pre></div>
<p>The Francis &amp; Thunell paper showed a 0.0135577 probability of
getting 6 of 6 studies significant. Our re-simulation showed a 0.0130462
probability.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lisa DeBruine.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
