<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mixed Effects • dsw</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mixed Effects">
<meta property="og:description" content="dsw">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsw</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calories.html">Calorie Placement Re-Simulation</a>
    </li>
    <li>
      <a href="../articles/faux.html">Intro to Faux</a>
    </li>
    <li>
      <a href="../articles/fixed.html">Fixed Effects</a>
    </li>
    <li>
      <a href="../articles/mixed.html">Mixed Effects</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/debruine/data-sim-workshop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mixed Effects</h1>
                        <h4 data-toc-skip class="author">Lisa
DeBruine</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/debruine/data-sim-workshop/blob/HEAD/vignettes/mixed.Rmd" class="external-link"><code>vignettes/mixed.Rmd</code></a></small>
      <div class="hidden name"><code>mixed.Rmd</code></div>

    </div>

    
    
<p>Generate data for a Stroop task where people (<code>subjects</code>)
say the colour of colour words (<code>stimuli</code>) shown in each of
two versions (<code>congruent</code> and <code>incongruent</code>).
Subjects are in one of two conditions (<code>hard</code> or
<code>easy</code>). The dependent variable (<code>DV</code>) is reaction
time.</p>
<p>We expect people to have faster reaction times for congruent stimuli
than incongruent stimuli (main effect of version) and to be faster in
the easy condition than the hard condition (main effect of condition).
We’ll look at some different interaction patterns below.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>   <span class="co"># for data wrangling, pipes, and good dataviz</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://afex.singmann.science/" class="external-link">afex</a></span><span class="op">)</span>        <span class="co"># for mixed effect models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed" class="external-link">broom.mixed</a></span><span class="op">)</span> <span class="co"># for getting tidy data tables from mixed models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux" class="external-link">faux</a></span><span class="op">)</span>        <span class="co"># for simulating correlated variables</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span>, scipen <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<div class="section level3">
<h3 id="random-factors">Random Factors<a class="anchor" aria-label="anchor" href="#random-factors"></a>
</h3>
<p>First, set up the overall structure of your data by specifying the
number of observations for each random factor. Here, we have a crossed
design, so each subject responds to each stimulus. We’ll set the numbers
to small numbers as a demo first.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">##   sub   stim </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub1  stim1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sub1  stim2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sub2  stim1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> sub2  stim2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fixed-factors">Fixed Factors<a class="anchor" aria-label="anchor" href="#fixed-factors"></a>
</h3>
<p>Next, add the fixed factors. Specify if they vary between one of the
random factors and specify the names of the levels.</p>
<p>Each subject is in only one condition, so the code below assigns half
<code>easy</code> and half <code>hard</code>. You can change the
proportion of subjects assigned each level with the <code>.prob</code>
argument.</p>
<p>Stimuli are seen in both <code>congruent</code> and
<code>incongruent</code> versions, so this will double the number of
rows in our resulting data set.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">##   sub   stim  condition version    </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub1  stim1 easy      congruent  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sub1  stim1 easy      incongruent</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sub1  stim2 easy      congruent  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> sub1  stim2 easy      incongruent</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> sub2  stim1 hard      congruent  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sub2  stim1 hard      incongruent</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> sub2  stim2 hard      congruent  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> sub2  stim2 hard      incongruent</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="contrast-coding">Contrast Coding<a class="anchor" aria-label="anchor" href="#contrast-coding"></a>
</h3>
<p>To be able to calculate the dependent variable, you need to recode
categorical variables into numbers. Use the helper function
<code><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast()</a></code> for this. The code below creates anova-coded
versions of <code>condition</code> and <code>version</code>. Luckily for
us, the factor levels default to a sensible order, with “easy” predicted
to have a faster (lower) reactive time than “hard”, and “congruent”
predicted to have a faster RT than “incongruent”, but we can also
customise the order of levels with <code><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast()</a></code>; see the
<a href="https://debruine.github.io/faux/articles/contrasts.html" class="external-link">contrasts
vignette</a> for more details.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 6</span></span></span>
<span><span class="co">##   sub   stim  condition version     `condition.hard-easy` version.incongruent-…¹</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub1  stim1 easy      congruent                    -<span style="color: #BB0000;">0.5</span>                   -<span style="color: #BB0000;">0.5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sub1  stim1 easy      incongruent                  -<span style="color: #BB0000;">0.5</span>                    0.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sub1  stim2 easy      congruent                    -<span style="color: #BB0000;">0.5</span>                   -<span style="color: #BB0000;">0.5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> sub1  stim2 easy      incongruent                  -<span style="color: #BB0000;">0.5</span>                    0.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> sub2  stim1 hard      congruent                     0.5                   -<span style="color: #BB0000;">0.5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sub2  stim1 hard      incongruent                   0.5                    0.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> sub2  stim2 hard      congruent                     0.5                   -<span style="color: #BB0000;">0.5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> sub2  stim2 hard      incongruent                   0.5                    0.5</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated name: ¹​`version.incongruent-congruent`</span></span></span></code></pre></div>
<p>The function defaults to very descriptive names that help you
interpret the fixed factors. Here, “condition.hard-easy” means the main
effect of this factor is interpreted as the RT for hard trials minus the
RT for easy trials, and “version.incongruent-congruent” means the main
effect of this factor is interpreted as the RT for incongruent trials
minus the RT for congruent trials. However, we can change these to
simpler labels with the <code>colnames</code> argument.</p>
</div>
<div class="section level3">
<h3 id="random-effects">Random Effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h3>
<p>Now we specify the random effect structure. We’ll just add random
intercepts to start, but will conver random slopes later.</p>
<p>Each subject will have slightly faster or slower reaction times on
average; this is their random intercept (<code>sub_i</code>). We’ll
model it from a normal distribution with a mean of 0 and SD of
100ms.</p>
<p>Each stimulus will have slightly faster or slower reaction times on
average; this is their random intercept (<code>stim_i</code>). We’ll
model it from a normal distribution with a mean of 0 and SD of 50ms (it
seems reasonable to expect less variability between words than people
for this task).</p>
<p>Run this code a few times to see how the random effects change each
time. this is because they are <strong>sampled</strong> from
populations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># SD for the stimuli's random intercept</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 8</span></span></span>
<span><span class="co">##   sub   stim  condition version      cond  vers sub_i stim_i</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub1  stim1 easy      congruent    -<span style="color: #BB0000;">0.5</span>  -<span style="color: #BB0000;">0.5</span> -<span style="color: #BB0000;">99.7</span>  -<span style="color: #BB0000;">30.9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sub1  stim1 easy      incongruent  -<span style="color: #BB0000;">0.5</span>   0.5 -<span style="color: #BB0000;">99.7</span>  -<span style="color: #BB0000;">30.9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sub1  stim2 easy      congruent    -<span style="color: #BB0000;">0.5</span>  -<span style="color: #BB0000;">0.5</span> -<span style="color: #BB0000;">99.7</span>  101. </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> sub1  stim2 easy      incongruent  -<span style="color: #BB0000;">0.5</span>   0.5 -<span style="color: #BB0000;">99.7</span>  101. </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> sub2  stim1 hard      congruent     0.5  -<span style="color: #BB0000;">0.5</span>  72.2  -<span style="color: #BB0000;">30.9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sub2  stim1 hard      incongruent   0.5   0.5  72.2  -<span style="color: #BB0000;">30.9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> sub2  stim2 hard      congruent     0.5  -<span style="color: #BB0000;">0.5</span>  72.2  101. </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> sub2  stim2 hard      incongruent   0.5   0.5  72.2  101.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="error-term">Error Term<a class="anchor" aria-label="anchor" href="#error-term"></a>
</h3>
<p>Finally, add an error term. This uses the same
<code><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef()</a></code> function, just without specifying which random
factor it’s for with <code>.by</code>. In essence, this samples an error
value from a normal distribution with a mean of 0 and the specified SD
for each trial. We’ll also increase the number of subjects and stimuli
to more realistic values now.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>    <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>   <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span>   <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span>  <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># SD for the stimuli's random intercept</span></span>
<span><span class="va">error_sd</span> <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-dv">Calculate DV<a class="anchor" aria-label="anchor" href="#calculate-dv"></a>
</h3>
<p>Now we can calculate the DV by adding together an overall intercept
(mean RT for all trials), the subject-specific intercept, the
stimulus-specific intercept, and an error term, plus the effect of
subject condition, the effect of stimulus version, and the interaction
between condition and version.</p>
<p>We set these effects in raw units (ms). So when we set the effect of
subject condition (<code>sub_cond_eff</code>) to 50, that means the
average difference between the easy and hard condition is 50ms.
<code>Easy</code> was coded as -0.5 and <code>hard</code> was coded as
+0.5, which means that trials in the easy condition have -0.5 * 50ms
(i.e., -25ms) added to their reaction time, while trials in the hard
condition have +0.5 * 50ms (i.e., +25ms) added to their reaction
time.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>         <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>        <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span>        <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span>       <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># SD for the stimuli's random intercept</span></span>
<span><span class="va">error_sd</span>      <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></span>
<span><span class="va">grand_i</span>       <span class="op">&lt;-</span> <span class="fl">400</span> <span class="co"># overall mean DV</span></span>
<span><span class="va">cond_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between conditions: hard - easy</span></span>
<span><span class="va">vers_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between versions: incongruent - congruent</span></span>
<span><span class="va">cond_vers_ixn</span> <span class="op">&lt;-</span>  <span class="fl">0</span>  <span class="co"># interaction between version and condition</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">cond_vers_ixn</span><span class="op">)</span> <span class="co"># in this example, this is always 0 and could be omitted</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>As always, graph to make sure you’ve simulated the general pattern
you expected.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">dv</span>, color <span class="op">=</span> <span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               fun.min <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               fun.max <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-dv-1.png" alt="Double-check the simulated pattern" width="100%"><p class="caption">
Double-check the simulated pattern
</p>
</div>
</div>
<div class="section level3">
<h3 id="interactions">Interactions<a class="anchor" aria-label="anchor" href="#interactions"></a>
</h3>
<p>If you want to simulate an interaction, it can be tricky to figure
out what to set the main effects and interaction effect to. It can be
easier to think about the simple main effects for each cell. Create four
new variables and set them to the deviations from the overall mean you’d
expect for each condition (so they should add up to 0). Here, we’re
simulating a small effect of version in the hard condition (50ms
difference) and double that effect of version in the easy condition
(100ms difference).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set variables to use in calculations below</span></span>
<span><span class="va">hard_congr</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">25</span></span>
<span><span class="va">hard_incon</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">25</span></span>
<span><span class="va">easy_congr</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span></span>
<span><span class="va">easy_incon</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">50</span></span></code></pre></div>
<p>Use the code below to transform the simple main effects above into
main effects and interactions for use in the equations below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate main effects and interactions from simple effects above</span></span>
<span></span>
<span><span class="co"># mean difference between easy and hard conditions</span></span>
<span><span class="va">cond_eff</span>     <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hard_congr</span> <span class="op">+</span> <span class="va">hard_incon</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span></span>
<span>                <span class="op">(</span><span class="va">easy_congr</span> <span class="op">+</span> <span class="va">easy_incon</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># mean difference between incongruent and congruent versions</span></span>
<span><span class="va">vers_eff</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hard_incon</span> <span class="op">+</span> <span class="va">easy_incon</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> </span>
<span>            <span class="op">(</span><span class="va">hard_congr</span> <span class="op">+</span> <span class="va">easy_congr</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># interaction between version and condition</span></span>
<span><span class="va">cond_vers_ixn</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hard_incon</span> <span class="op">-</span> <span class="va">hard_congr</span><span class="op">)</span> <span class="op">-</span></span>
<span>                 <span class="op">(</span><span class="va">easy_incon</span> <span class="op">-</span> <span class="va">easy_congr</span><span class="op">)</span></span></code></pre></div>
<p>Then generate the DV the same way we did above, but also add the
interaction effect multiplied by the effect-coded subject condition and
stimulus version.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">cond_vers_ixn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">dv</span>, color <span class="op">=</span> <span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               fun.min <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               fun.max <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-ixn-1.png" alt="Double-check the interaction between condition and version" width="100%"><p class="caption">
Double-check the interaction between condition and version
</p>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">condition</span>, <span class="va">version</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dv</span><span class="op">)</span> <span class="op">-</span> <span class="va">grand_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">version</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">##   condition congruent incongruent</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> easy          -<span style="color: #BB0000;">53.4</span>        46.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> hard          -<span style="color: #BB0000;">18.6</span>        31.0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>New we will run a linear mixed effects model with <code>lmer</code>
and look at the summary.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod.sum</span></span>
<span><span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span></span>
<span><span class="co">## lmerModLmerTest]</span></span>
<span><span class="co">## Formula: dv ~ cond * vers + (1 | sub) + (1 | stim)</span></span>
<span><span class="co">##    Data: dat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## REML criterion at convergence: 187474</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Scaled residuals: </span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -4.154 -0.668  0.000  0.674  4.604 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">##  sub      (Intercept) 12456    111.6   </span></span>
<span><span class="co">##  stim     (Intercept)  2755     52.5   </span></span>
<span><span class="co">##  Residual               628     25.1   </span></span>
<span><span class="co">## Number of obs: 20000, groups:  sub, 200; stim, 50</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##              Estimate Std. Error        df t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)   401.417     10.836   168.863   37.05   &lt;2e-16 ***</span></span>
<span><span class="co">## cond            9.554     15.788   198.001    0.61     0.55    </span></span>
<span><span class="co">## vers           74.834      0.354 19749.000  211.16   &lt;2e-16 ***</span></span>
<span><span class="co">## cond:vers     -50.516      0.709 19749.000  -71.27   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Correlation of Fixed Effects:</span></span>
<span><span class="co">##           (Intr) cond  vers </span></span>
<span><span class="co">## cond      0.000             </span></span>
<span><span class="co">## vers      0.000  0.000      </span></span>
<span><span class="co">## cond:vers 0.000  0.000 0.000</span></span></code></pre></div>
<div class="section level3">
<h3 id="sense-checks">Sense checks<a class="anchor" aria-label="anchor" href="#sense-checks"></a>
</h3>
<p>First, check that your groups make sense.</p>
<ul>
<li>The number of obs should be the total number of trials
analysed.</li>
<li>
<code>sub</code> should be what we set <code>sub_n</code> to
above.</li>
<li>
<code>stim</code> should be what we set <code>stim_n</code> to
above.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.sum</span><span class="op">$</span><span class="va">ngrps</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"Random.Fator"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sub_n</span>, <span class="va">stim_n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">##   Random.Fator value parameters</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub            200        200</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> stim            50         50</span></span></code></pre></div>
<p>Next, look at the random effects.</p>
<ul>
<li>The SD for <code>sub</code> should be near <code>sub_sd</code>.</li>
<li>The SD for <code>stim</code> should be near
<code>stim_sd</code>.</li>
<li>The residual SD should be near <code>error_sd</code>.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.sum</span><span class="op">$</span><span class="va">varcor</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>Groups <span class="op">=</span> <span class="va">grp</span>, Name <span class="op">=</span> <span class="va">var1</span>, <span class="st">"Std.Dev."</span> <span class="op">=</span> <span class="va">sdcor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sub_sd</span>, <span class="va">stim_sd</span>, <span class="va">error_sd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">##   Groups   Name        Std.Dev. parameters</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub      (Intercept)    112.         100</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> stim     (Intercept)     52.5         50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Residual <span style="color: #BB0000;">NA</span>              25.1         25</span></span></code></pre></div>
<p>Finally, look at the fixed effects.</p>
<ul>
<li>The estimate for the Intercept should be near the
<code>grand_i</code>.</li>
<li>The main effect of <code>cond</code> should be near what we
calculated for <code>cond_eff</code>.</li>
<li>The main effect of <code>vers</code> should be near what we
calculated for <code>vers_eff</code>.</li>
<li>The interaction between <code>cond</code>:<code>vers</code> should
be near what we calculated for <code>cond_vers_ixn</code>.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.sum</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"Effect"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Effect</span>, <span class="va">Estimate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">grand_i</span>, <span class="va">cond_eff</span>, <span class="va">vers_eff</span>, <span class="va">cond_vers_ixn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">##   Effect      Estimate parameters</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)   401.          400</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> cond            9.55          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> vers           74.8          75</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> cond:vers     -<span style="color: #BB0000;">50.5</span>         -<span style="color: #BB0000;">50</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-effects-1">Random effects<a class="anchor" aria-label="anchor" href="#random-effects-1"></a>
</h3>
<p>Plot the subject intercepts from our code above
(<code>dat$sub_i</code>) against the subject intercepts calculated by
<code>lmer</code> (<code>ranef(mod)$sub_id</code>).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get simulated random intercept for each subject</span></span>
<span><span class="va">sub_sim</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sub</span>, <span class="va">sub_i</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>.groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join to calculated random intercept from model</span></span>
<span><span class="va">sub_sim_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">sub</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"sub"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_sub_i <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sub_sim</span>, by <span class="op">=</span> <span class="st">"sub"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot to check correspondence</span></span>
<span><span class="va">sub_sim_mod</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sub_i</span>,<span class="va">mod_sub_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Simulated random intercepts (sub_i)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Modeled random intercepts"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-sub-ranef-1.png" alt="Compare simulated subject random intercepts to those from the model" width="100%"><p class="caption">
Compare simulated subject random intercepts to those from the model
</p>
</div>
<p>Plot the stimulus intercepts from our code above
(<code>dat$stim_i</code>) against the stimulus intercepts calculated by
<code>lmer</code> (<code>ranef(mod)$stim_id</code>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get simulated random intercept for each stimulus</span></span>
<span><span class="va">stim_sim</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">stim</span>, <span class="va">stim_i</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>.groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join to calculated random intercept from model</span></span>
<span><span class="va">stim_sim_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">stim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"stim"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_stim_i <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stim_sim</span>, by <span class="op">=</span> <span class="st">"stim"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot to check correspondence</span></span>
<span><span class="va">stim_sim_mod</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">stim_i</span>,<span class="va">mod_stim_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Simulated random intercepts (stim_i)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Modeled random intercepts"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-stim-ranef-1.png" alt="Compare simulated stimulus random intercepts to those from the model" width="100%"><p class="caption">
Compare simulated stimulus random intercepts to those from the model
</p>
</div>
</div>
<div class="section level3">
<h3 id="function">Function<a class="anchor" aria-label="anchor" href="#function"></a>
</h3>
<p>You can put the code above in a function so you can run it more
easily and change the parameters. I removed the plot and set the
argument defaults to the same as the example above with all fixed
effects set to 0, but you can set them to other patterns.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_lmer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">sub_n</span> <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                      <span class="va">stim_n</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                      <span class="va">sub_sd</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                      <span class="va">stim_sd</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                      <span class="va">error_sd</span> <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                      <span class="va">grand_i</span> <span class="op">=</span> <span class="fl">400</span>,</span>
<span>                      <span class="va">cond_eff</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                      <span class="va">vers_eff</span> <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                      <span class="va">cond_vers_ixn</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">cond_vers_ixn</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run the function with the default values (so all fixed effects set to
0).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span></span>
<span><span class="co">## Model failed to converge with max|grad| = 0.00216013 (tol = 0.002, component 1)</span></span>
<span><span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span></span>
<span><span class="co">## lmerModLmerTest]</span></span>
<span><span class="co">## Formula: dv ~ cond * vers + (1 | sub) + (1 | stim)</span></span>
<span><span class="co">##    Data: dat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## REML criterion at convergence: 187222</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Scaled residuals: </span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -4.191 -0.666  0.005  0.671  3.958 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">##  sub      (Intercept) 11254    106.1   </span></span>
<span><span class="co">##  stim     (Intercept)  3062     55.3   </span></span>
<span><span class="co">##  Residual               620     24.9   </span></span>
<span><span class="co">## Number of obs: 20000, groups:  sub, 200; stim, 50</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##              Estimate Std. Error        df t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)   399.955     10.842   149.164   36.89   &lt;2e-16 ***</span></span>
<span><span class="co">## cond           14.384     15.007   198.045    0.96     0.34    </span></span>
<span><span class="co">## vers           -0.111      0.352 19748.984   -0.31     0.75    </span></span>
<span><span class="co">## cond:vers       0.817      0.705 19748.984    1.16     0.25    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Correlation of Fixed Effects:</span></span>
<span><span class="co">##           (Intr) cond  vers </span></span>
<span><span class="co">## cond      0.000             </span></span>
<span><span class="co">## vers      0.000  0.000      </span></span>
<span><span class="co">## cond:vers 0.000  0.000 0.000</span></span>
<span><span class="co">## optimizer (nloptwrap) convergence code: 0 (OK)</span></span>
<span><span class="co">## Model failed to converge with max|grad| = 0.00216013 (tol = 0.002, component 1)</span></span></code></pre></div>
<p>Try changing some variables to simulate different patterns of fixed
effects.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer</span><span class="op">(</span>cond_eff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>         vers_eff <span class="op">=</span> <span class="fl">75</span>, </span>
<span>         cond_vers_ixn <span class="op">=</span> <span class="op">-</span><span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span></span>
<span><span class="co">## lmerModLmerTest]</span></span>
<span><span class="co">## Formula: dv ~ cond * vers + (1 | sub) + (1 | stim)</span></span>
<span><span class="co">##    Data: dat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## REML criterion at convergence: 187381</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Scaled residuals: </span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -4.761 -0.674 -0.007  0.665  3.875 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">##  sub      (Intercept) 9410     97.0    </span></span>
<span><span class="co">##  stim     (Intercept) 2260     47.5    </span></span>
<span><span class="co">##  Residual              627     25.0    </span></span>
<span><span class="co">## Number of obs: 20000, groups:  sub, 200; stim, 50</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##              Estimate Std. Error        df t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)   396.707      9.606   160.847   41.30   &lt;2e-16 ***</span></span>
<span><span class="co">## cond           -9.966     13.723   198.000   -0.73     0.47    </span></span>
<span><span class="co">## vers           75.323      0.354 19749.000  212.69   &lt;2e-16 ***</span></span>
<span><span class="co">## cond:vers     -49.997      0.708 19749.000  -70.59   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Correlation of Fixed Effects:</span></span>
<span><span class="co">##           (Intr) cond  vers </span></span>
<span><span class="co">## cond      0.000             </span></span>
<span><span class="co">## vers      0.000  0.000      </span></span>
<span><span class="co">## cond:vers 0.000  0.000 0.000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="power-analysis">Power analysis<a class="anchor" aria-label="anchor" href="#power-analysis"></a>
</h3>
<p>First, wrap your simulation function inside of another function that
takes the argument of a replication number, runs a simulated analysis,
and returns a data table of the fixed and random effects (made with
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom.mixed::tidy()</a></code>). You can use purrr’s
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df()</a></code> function to create a data table of results from
multiple replications of this function. We’re only running 10
replications here in the interests of time, but you’ll want to run 100
or more for a proper power calculation.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sim_lmer_pwr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rep</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">sim_lmer</span><span class="op">(</span>cond_eff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                vers_eff <span class="op">=</span> <span class="fl">75</span>, </span>
<span>                cond_vers_ixn <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># put just the fixed effects into a data table</span></span>
<span>  <span class="fu">broom.mixed</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"fixed"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rep <span class="op">=</span> <span class="va">rep</span><span class="op">)</span> <span class="co"># add a column for which rep</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">sim_lmer_pwr</span><span class="op">)</span></span></code></pre></div>
<p>You can then plot the distribution of estimates across your
simulations.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">my_power</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">estimate</span>, color <span class="op">=</span> <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mixed_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<p>You can also just calculate power as the proportion of p-values less
than your alpha.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_power</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">##   term        power</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)   1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> cond          0.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> cond:vers     1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> vers          1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="random-slopes">Random slopes<a class="anchor" aria-label="anchor" href="#random-slopes"></a>
</h2>
<p>In the example so far we’ve ignored random variation among subjects
or stimuli in the size of the fixed effects (i.e., <strong>random
slopes</strong>).</p>
<p>First, let’s reset the parameters we set above.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_n</span>         <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span></span>
<span><span class="va">stim_n</span>        <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># number of stimuli in this simulation</span></span>
<span><span class="va">sub_sd</span>        <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span></span>
<span><span class="va">stim_sd</span>       <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># SD for the stimuli's random intercept</span></span>
<span><span class="va">error_sd</span>      <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></span>
<span><span class="va">grand_i</span>       <span class="op">&lt;-</span> <span class="fl">400</span> <span class="co"># overall mean DV</span></span>
<span><span class="va">cond_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between conditions: hard - easy</span></span>
<span><span class="va">vers_eff</span>      <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between versions: incongruent - congruent</span></span>
<span><span class="va">cond_vers_ixn</span> <span class="op">&lt;-</span>  <span class="fl">0</span>  <span class="co"># interaction between version and condition</span></span></code></pre></div>
<div class="section level3">
<h3 id="slopes">Slopes<a class="anchor" aria-label="anchor" href="#slopes"></a>
</h3>
<p>In addition to generating a random intercept for each subject, now we
will also generate a random slope for any within-subject factors. The
only within-subject factor in this design is <code>version</code>. The
main effect of <code>version</code> is set to 50 above, but different
subjects will show variation in the size of this effect. That’s what the
random slope captures. We’ll set <code>sub_vers_sd</code> below to the
SD of this variation and use this to calculate the random slope
(<code>sub_version_slope</code>) for each subject.</p>
<p>Also, it’s likely that the variation between subjects in the size of
the effect of version is related in some way to between-subject
variation in the intercept. So we want the random intercept and slope to
be correlated. Here, we’ll simulate a case where subjects who have
slower (larger) reaction times across the board show a smaller effect of
condition, so we set <code>sub_i_vers_cor</code> below to a negative
number (-0.2).</p>
<p>We just have to edit the first <code><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef()</a></code> to add two
variables (<code>sub_i</code>, <code>sub_vers_slope</code>) that are
correlated with r = -0.2, means of 0, and SDs equal to what we set
<code>sub_sd</code> above and <code>sub_vers_sd</code> below.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_vers_sd</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">sub_i_vers_cor</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.2</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="correlated-slopes">Correlated Slopes<a class="anchor" aria-label="anchor" href="#correlated-slopes"></a>
</h3>
<p>In addition to generating a random intercept for each stimulus, we
will also generate a random slope for any within-stimulus factors. Both
<code>version</code> and <code>condition</code> are within-stimulus
factors (i.e., all stimuli are seen in both <code>congruent</code> and
<code>incongruent</code> versions and both <code>easy</code> and
<code>hard</code> conditions). So the main effects of version and
condition (and their interaction) will vary depending on the
stimulus.</p>
<p>They will also be correlated, but in a more complex way than above.
You need to set the correlations for all pairs of slopes and intercept.
Let’s set the correlation between the random intercept and each of the
slopes to -0.4 and the slopes all correlate with each other +0.2 (You
could set each of the six correlations separately if you want,
though).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">stim_vers_sd</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># SD for the stimuli's random slope for stim_version</span></span>
<span><span class="va">stim_cond_sd</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># SD for the stimuli's random slope for sub_cond</span></span>
<span><span class="va">stim_cond_vers_sd</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># SD for the stimuli's random slope for sub_cond:stim_version</span></span>
<span><span class="va">stim_i_cor</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.4</span> <span class="co"># correlations between intercept and slopes</span></span>
<span><span class="va">stim_s_cor</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">0.2</span> <span class="co"># correlations among slopes</span></span>
<span></span>
<span><span class="co"># specify correlations for rnorm_multi (one of several methods)</span></span>
<span><span class="va">stim_cors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>,</span>
<span>                           <span class="va">stim_s_cor</span>, <span class="va">stim_s_cor</span>,</span>
<span>                                       <span class="va">stim_s_cor</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span>,</span>
<span>              stim_vers_slope <span class="op">=</span> <span class="va">stim_vers_sd</span>,</span>
<span>              stim_cond_slope <span class="op">=</span> <span class="va">stim_cond_sd</span>,</span>
<span>              stim_cond_vers_slope <span class="op">=</span> <span class="va">stim_cond_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">stim_cors</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-dv-1">Calculate DV<a class="anchor" aria-label="anchor" href="#calculate-dv-1"></a>
</h3>
<p>Now we can calculate the DV by adding together an overall intercept
(mean RT for all trials), the subject-specific intercept, the
stimulus-specific intercept, the effect of subject condition, the
stimulus-specific slope for condition, the effect of stimulus version,
the stimulus-specific slope for version, the subject-specific slope for
condition, the interaction between condition and version (set to 0 for
this example), the stimulus-specific slope for the interaction between
condition and version, and an error term.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span>,</span>
<span>              stim_vers_slope <span class="op">=</span> <span class="va">stim_vers_sd</span>,</span>
<span>              stim_cond_slope <span class="op">=</span> <span class="va">stim_cond_sd</span>,</span>
<span>              stim_cond_vers_slope <span class="op">=</span> <span class="va">stim_cond_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">stim_cors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    trial_cond_eff <span class="op">=</span> <span class="va">cond_eff</span> <span class="op">+</span> <span class="va">stim_cond_slope</span>,</span>
<span>    trial_vers_eff <span class="op">=</span> <span class="va">vers_eff</span> <span class="op">+</span> <span class="va">sub_vers_slope</span> <span class="op">+</span> <span class="va">stim_vers_slope</span>,</span>
<span>    trial_cond_vers_ixn <span class="op">=</span> <span class="va">cond_vers_ixn</span> <span class="op">+</span> <span class="va">stim_cond_vers_slope</span>,</span>
<span>    dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">trial_cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">trial_vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>         <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">trial_cond_vers_ixn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>As always, graph to make sure you’ve simulated the general pattern
you expected.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">dv</span>, color <span class="op">=</span> <span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               fun.min <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               fun.max <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/rslope-plot-dv-1.png" alt="Double-check the simulated pattern" width="100%"><p class="caption">
Double-check the simulated pattern
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="analysis-1">Analysis<a class="anchor" aria-label="anchor" href="#analysis-1"></a>
</h2>
<p>New we’ll run a linear mixed effects model with <code>lmer</code> and
look at the summary. You specify random slopes by adding the
within-level effects to the random intercept specifications. Since the
only within-subject factor is version, the random effects specification
for subjects is <code>(1 + vers | sub)</code>. Since both condition and
version are within-stimuli factors, the random effects specification for
stimuli is <code>(1 + vers*cond | stim)</code>.</p>
<p>This model will take a lot longer to run than one without random
slopes specified. This might be a good time for a coffee break.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span> <span class="op">||</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span><span class="op">*</span><span class="va">cond</span> <span class="op">||</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod.sum</span></span>
<span><span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span></span>
<span><span class="co">## lmerModLmerTest]</span></span>
<span><span class="co">## Formula: dv ~ cond * vers + (1 + vers || sub) + (1 + vers * cond || stim)</span></span>
<span><span class="co">##    Data: dat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## REML criterion at convergence: 188362</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Scaled residuals: </span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -3.713 -0.672  0.003  0.667  3.928 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">##  sub      (Intercept) 9969.0   99.84   </span></span>
<span><span class="co">##  sub.1    vers         369.5   19.22   </span></span>
<span><span class="co">##  stim     (Intercept) 4056.8   63.69   </span></span>
<span><span class="co">##  stim.1   vers          81.7    9.04   </span></span>
<span><span class="co">##  stim.2   cond        1099.1   33.15   </span></span>
<span><span class="co">##  stim.3   vers:cond    225.7   15.02   </span></span>
<span><span class="co">##  Residual              623.8   24.98   </span></span>
<span><span class="co">## Number of obs: 20000, groups:  sub, 200; stim, 50</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##             Estimate Std. Error     df t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)   412.57      11.45 116.72   36.04   &lt; 2e-16 ***</span></span>
<span><span class="co">## cond           73.93      14.88 232.50    4.97 0.0000013 ***</span></span>
<span><span class="co">## vers           46.66       1.90 157.10   24.57   &lt; 2e-16 ***</span></span>
<span><span class="co">## cond:vers      -4.00       3.52 185.97   -1.14      0.26    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Correlation of Fixed Effects:</span></span>
<span><span class="co">##           (Intr) cond  vers </span></span>
<span><span class="co">## cond      0.000             </span></span>
<span><span class="co">## vers      0.000  0.000      </span></span>
<span><span class="co">## cond:vers 0.000  0.000 0.000</span></span></code></pre></div>
<div class="section level3">
<h3 id="sense-checks-1">Sense checks<a class="anchor" aria-label="anchor" href="#sense-checks-1"></a>
</h3>
<p>First, check that your groups make sense.</p>
<ul>
<li>
<code>sub</code> = <code>sub_n</code> (200)</li>
<li>
<code>stim</code> = <code>stim_n</code> (50)</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.sum</span><span class="op">$</span><span class="va">ngrps</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"Random.Fator"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sub_n</span>, <span class="va">stim_n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">##   Random.Fator value parameters</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub            200        200</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> stim            50         50</span></span></code></pre></div>
<p>Next, look at the SDs for the random effects.</p>
<ul>
<li>Group:<code>sub</code>
<ul>
<li>
<code>(Intercept)</code> ~= <code>sub_sd</code>
</li>
<li>
<code>vers</code> ~= <code>sub_vers_sd</code>
</li>
</ul>
</li>
<li>Group: <code>stim</code>
<ul>
<li>
<code>(Intercept)</code> ~= <code>stim_sd</code>
</li>
<li>
<code>vers</code> ~= <code>stim_vers_sd</code>
</li>
<li>
<code>cond</code> ~= <code>stim_cond_sd</code>
</li>
<li>
<code>vers:cond</code> ~= <code>stim_cond_vers_sd</code>
</li>
</ul>
</li>
<li>Residual ~= <code>error_sd</code>
</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.sum</span><span class="op">$</span><span class="va">varcor</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>Groups <span class="op">=</span> <span class="va">grp</span>, Name <span class="op">=</span> <span class="va">var1</span>, <span class="st">"Std.Dev."</span> <span class="op">=</span> <span class="va">sdcor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sub_sd</span>, <span class="va">sub_vers_sd</span>, <span class="va">stim_sd</span>, <span class="va">stim_vers_sd</span>, <span class="va">stim_cond_sd</span>, <span class="va">stim_cond_vers_sd</span>, <span class="va">error_sd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">##   Groups   Name        Std.Dev. parameters</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sub      (Intercept)    99.8         100</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sub.1    vers           19.2          20</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> stim     (Intercept)    63.7          50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> stim.1   vers            9.04         10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> stim.2   cond           33.2          30</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> stim.3   vers:cond      15.0          15</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> Residual <span style="color: #BB0000;">NA</span>             25.0          25</span></span></code></pre></div>
<p>The correlations are a bit more difficult to parse. The first column
under <code>Corr</code> shows the correlation between the random slope
for that row and the random intercept. So for <code>vers</code> under
<code>sub</code>, the correlation should be close to
<code>sub_i_vers_cor</code>. For all three random slopes under
<code>stim</code>, the correlation with the random intercept should be
near <code>stim_i_cor</code> and their correlations with each other
should be near <code>stim_s_cor</code>.</p>
<p>Finally, look at the fixed effects.</p>
<ul>
<li>
<code>(Intercept)</code> ~= <code>grand_i</code>
</li>
<li>
<code>sub_cond.e</code> ~= <code>sub_cond_eff</code>
</li>
<li>
<code>stim_version.e</code> ~= <code>stim_vers_eff</code>
</li>
<li>
<code>sub_cond.e</code>:<code>stim_version.e</code> ~=
<code>cond_vers_ixn</code>
</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.sum</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"Effect"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Effect</span>, <span class="va">Estimate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">grand_i</span>, <span class="va">cond_eff</span>, <span class="va">vers_eff</span>, <span class="va">cond_vers_ixn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">##   Effect      Estimate parameters</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)   413.          400</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> cond           73.9          50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> vers           46.7          50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> cond:vers      -<span style="color: #BB0000;">4.00</span>          0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="function-1">Function<a class="anchor" aria-label="anchor" href="#function-1"></a>
</h3>
<p>You can put the code above in a function so you can run it more
easily and change the parameters. I removed the plot and set the
argument defaults to the same as the example above, but you can set them
to other patterns.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_lmer_slope</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">sub_n</span> <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                            <span class="va">stim_n</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                            <span class="va">sub_sd</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                            <span class="va">sub_vers_sd</span> <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                            <span class="va">sub_i_vers_cor</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>,</span>
<span>                            <span class="va">stim_sd</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                            <span class="va">stim_vers_sd</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                            <span class="va">stim_cond_sd</span> <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                            <span class="va">stim_cond_vers_sd</span> <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                            <span class="va">stim_i_cor</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span>,</span>
<span>                            <span class="va">stim_s_cor</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.2</span>,</span>
<span>                            <span class="va">error_sd</span> <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                            <span class="va">grand_i</span> <span class="op">=</span> <span class="fl">400</span>,</span>
<span>                            <span class="va">sub_cond_eff</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                            <span class="va">stim_vers_eff</span> <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                            <span class="va">cond_vers_ixn</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="va">sub_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_random.html" class="external-link">add_random</a></span><span class="op">(</span>stim <span class="op">=</span> <span class="va">stim_n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_between.html" class="external-link">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_within.html" class="external-link">add_within</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_contrast.html" class="external-link">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"sub"</span>, sub_i <span class="op">=</span> <span class="va">sub_sd</span>, </span>
<span>              sub_vers_slope <span class="op">=</span> <span class="va">sub_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">sub_i_vers_cor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"stim"</span>, stim_i <span class="op">=</span> <span class="va">stim_sd</span>,</span>
<span>              stim_vers_slope <span class="op">=</span> <span class="va">stim_vers_sd</span>,</span>
<span>              stim_cond_slope <span class="op">=</span> <span class="va">stim_cond_sd</span>,</span>
<span>              stim_cond_vers_slope <span class="op">=</span> <span class="va">stim_cond_vers_sd</span>,</span>
<span>              .cors <span class="op">=</span> <span class="va">stim_cors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/faux/man/add_ranef.html" class="external-link">add_ranef</a></span><span class="op">(</span>err <span class="op">=</span> <span class="va">error_sd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      trial_cond_eff <span class="op">=</span> <span class="va">cond_eff</span> <span class="op">+</span> <span class="va">stim_cond_slope</span>,</span>
<span>      trial_vers_eff <span class="op">=</span> <span class="va">vers_eff</span> <span class="op">+</span> <span class="va">sub_vers_slope</span> <span class="op">+</span> <span class="va">stim_vers_slope</span>,</span>
<span>      trial_cond_vers_ixn <span class="op">=</span> <span class="va">cond_vers_ixn</span> <span class="op">+</span> <span class="va">stim_cond_vers_slope</span>,</span>
<span>      dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span></span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">trial_cond_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">vers</span> <span class="op">*</span> <span class="va">trial_vers_eff</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">*</span> <span class="va">trial_cond_vers_ixn</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span> <span class="op">||</span> <span class="va">sub</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">vers</span><span class="op">*</span><span class="va">cond</span> <span class="op">||</span> <span class="va">stim</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run the function with the default values (null fixed effects).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer_slope</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span></span>
<span><span class="co">## lmerModLmerTest]</span></span>
<span><span class="co">## Formula: dv ~ cond * vers + (1 + vers || sub) + (1 + vers * cond || stim)</span></span>
<span><span class="co">##    Data: dat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## REML criterion at convergence: 188480</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Scaled residuals: </span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -3.865 -0.661 -0.001  0.667  3.989 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">##  sub      (Intercept) 9835.3   99.17   </span></span>
<span><span class="co">##  sub.1    vers         363.3   19.06   </span></span>
<span><span class="co">##  stim     (Intercept) 2008.4   44.82   </span></span>
<span><span class="co">##  stim.1   vers          97.1    9.85   </span></span>
<span><span class="co">##  stim.2   cond         972.4   31.18   </span></span>
<span><span class="co">##  stim.3   vers:cond    206.3   14.36   </span></span>
<span><span class="co">##  Residual              629.0   25.08   </span></span>
<span><span class="co">## Number of obs: 20000, groups:  sub, 200; stim, 50</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##             Estimate Std. Error     df t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)   393.75       9.45 176.69   41.65  &lt; 2e-16 ***</span></span>
<span><span class="co">## cond           51.31      14.71 229.88    3.49  0.00058 ***</span></span>
<span><span class="co">## vers           46.13       1.97 141.92   23.41  &lt; 2e-16 ***</span></span>
<span><span class="co">## cond:vers      -2.55       3.45 190.63   -0.74  0.45979    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Correlation of Fixed Effects:</span></span>
<span><span class="co">##           (Intr) cond  vers </span></span>
<span><span class="co">## cond      0.000             </span></span>
<span><span class="co">## vers      0.000  0.000      </span></span>
<span><span class="co">## cond:vers 0.000  0.000 0.000</span></span></code></pre></div>
<p>Try changing some variables to simulate fixed effects.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim_lmer_slope</span><span class="op">(</span>sub_cond_eff <span class="op">=</span> <span class="fl">50</span>,</span>
<span>               stim_vers_eff <span class="op">=</span> <span class="fl">50</span>, </span>
<span>               cond_vers_ixn <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">## Linear mixed model fit by REML ['lmerModLmerTest']</span></span>
<span><span class="co">## Formula: dv ~ cond * vers + (1 + vers || sub) + (1 + vers * cond || stim)</span></span>
<span><span class="co">##    Data: dat</span></span>
<span><span class="co">## REML criterion at convergence: 188364</span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups   Name        Std.Dev.</span></span>
<span><span class="co">##  sub      (Intercept) 102.79  </span></span>
<span><span class="co">##  sub.1    vers         20.38  </span></span>
<span><span class="co">##  stim     (Intercept)  54.20  </span></span>
<span><span class="co">##  stim.1   vers          9.05  </span></span>
<span><span class="co">##  stim.2   cond         31.91  </span></span>
<span><span class="co">##  stim.3   vers:cond    16.81  </span></span>
<span><span class="co">##  Residual              24.96  </span></span>
<span><span class="co">## Number of obs: 20000, groups:  sub, 200; stim, 50</span></span>
<span><span class="co">## Fixed Effects:</span></span>
<span><span class="co">## (Intercept)         cond         vers    cond:vers  </span></span>
<span><span class="co">##      404.57        60.31        46.06        -2.81</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="exercises">Exercises<a class="anchor" aria-label="anchor" href="#exercises"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Calculate power for the parameters in the last example using the
<code>sim_lmer_slope()</code> function.</p></li>
<li><p>Simulate data for the following design:</p></li>
</ol>
<ul>
<li>100 raters rate 50 faces from group A and 50 faces from group B</li>
<li>The DV has a mean value of 50</li>
<li>Group B values are 5 points higher than group A</li>
<li>Rater intercepts have an SD of 5</li>
<li>Face intercepts have an SD of 10</li>
<li>The residual error has an SD of 8</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>For the design from exercise 2, write a function that simulates
data and runs a mixed effects analysis on it.</p></li>
<li><p>The package <code>faux</code> has a built-in dataset called
<code>fr4</code>. Type <code><a href="https://rdrr.io/pkg/faux/man/fr4.html" class="external-link">?faux::fr4</a></code> into the console to view
the help for this dataset. Run a mixed effects model on this dataset
looking at the effect of <code>face_sex</code> on ratings. Remember to
include a random slope for the effect of face sex and explicitly add a
contrast code.</p></li>
<li><p>Use the parameters from this analysis to simulate a new dataset
with 50 male and 50 female faces, and 100 raters.</p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lisa DeBruine.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
