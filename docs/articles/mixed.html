<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mixed Effects • dsw</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mixed Effects">
<meta property="og:description" content="dsw">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsw</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calories.html">Calorie Placement Re-Simulation</a>
    </li>
    <li>
      <a href="../articles/faux.html">Intro to Faux</a>
    </li>
    <li>
      <a href="../articles/fixed.html">Fixed Effects</a>
    </li>
    <li>
      <a href="../articles/mixed.html">Mixed Effects</a>
    </li>
    <li>
      <a href="../articles/mixed2.html">Mixed Effects 2.0</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/debruine/data-sim-workshop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mixed Effects</h1>
                        <h4 data-toc-skip class="author">Lisa
DeBruine</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/debruine/data-sim-workshop/blob/HEAD/vignettes/mixed.Rmd" class="external-link"><code>vignettes/mixed.Rmd</code></a></small>
      <div class="hidden name"><code>mixed.Rmd</code></div>

    </div>

    
    
<p>Generate data for a Stroop task where people (<code>subjects</code>)
say the colour of colour words (<code>stimuli</code>) shown in each of
two versions (<code>congruent</code> and <code>incongruent</code>).
Subjects are in one of two conditions (<code>hard</code> and
<code>easy</code>). The dependent variable (<code>DV</code>) is reaction
time.</p>
<p>We expect people to have faster reaction times for congruent stimuli
than incongruent stimuli (main effect of version) and to be faster in
the easy condition than the hard condition (main effect of condition).
We’ll look at some different interaction patterns below.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>   <span class="co"># for data wrangling, pipes, and good dataviz</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://afex.singmann.science/" class="external-link">afex</a></span><span class="op">)</span>        <span class="co"># for mixed effect models</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed" class="external-link">broom.mixed</a></span><span class="op">)</span> <span class="co"># for getting tidy data tables from mixed models</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux" class="external-link">faux</a></span><span class="op">)</span>        <span class="co"># for simulating correlated variables</span>

<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span>, scipen <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="random-intercepts">Random intercepts<a class="anchor" aria-label="anchor" href="#random-intercepts"></a>
</h2>
<div class="section level3">
<h3 id="subjects">Subjects<a class="anchor" aria-label="anchor" href="#subjects"></a>
</h3>
<p>First, we need to generate a sample of subjects. Each subject will
have slightly faster or slower reaction times on average; this is their
random intercept (<code>sub_i</code>). We’ll model it from a normal
distribution with a mean of 0 and SD of 100ms.</p>
<p>We also add between-subject variables here. Each subject is in only
one condition, so assign half <code>easy</code> and half
<code>hard</code>. Set the number of subjects as <code>sub_n</code> at
the beginning so you can change this in the future with only one
edit.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub_n</span>  <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span>
<span class="va">sub_sd</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span>

<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  sub_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">sub_n</span>,
  sub_i  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sub_n</span>, <span class="fl">0</span>, <span class="va">sub_sd</span><span class="op">)</span>, <span class="co"># random intercept</span>
  sub_cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sub_n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="co"># between-subjects factor</span>
<span class="op">)</span></code></pre></div>
<p>I like to check my simulations at every step with a graph. We expect
subjects in <code>hard</code> and <code>easy</code> conditions to have
approximately equal intercepts.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sub</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sub_i</span>, color <span class="op">=</span> <span class="va">sub_cond</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-subject-1.png" alt="Double-check subject intercepts" width="100%"><p class="caption">
Double-check subject intercepts
</p>
</div>
</div>
<div class="section level3">
<h3 id="stimuli">Stimuli<a class="anchor" aria-label="anchor" href="#stimuli"></a>
</h3>
<p>Now, we generate a sample of stimuli. Each stimulus will have
slightly faster or slower reaction times on average; this is their
random intercept (<code>stim_i</code>). We’ll model it from a normal
distribution with a mean of 0 and SD of 50ms (it seems reasonable to
expect less variability between words than people for this task).
Stimulus version (<code>congruent</code> vs <code>incongruent</code>) is
a within-stimulus variable, so we don’t need to add it here.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">stim_n</span>  <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># number of stimuli in this simulation</span>
<span class="va">stim_sd</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># SD for the stimuli's random intercept</span>

<span class="va">stim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  stim_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">stim_n</span>,
  stim_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">stim_n</span>, <span class="fl">0</span>, <span class="va">stim_sd</span><span class="op">)</span> <span class="co"># random intercept</span>
<span class="op">)</span></code></pre></div>
<p>Plot the random intercepts to double-check they look like you
expect.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">stim</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">stim_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-stimuli-1.png" alt="Double-check stimulus intercepts" width="100%"><p class="caption">
Double-check stimulus intercepts
</p>
</div>
</div>
<div class="section level3">
<h3 id="trials">Trials<a class="anchor" aria-label="anchor" href="#trials"></a>
</h3>
<p>Now we put the subjects and stimuli together. In this study, all
subjects respond to all stimuli in both congruent and incongruent
versions, but subjects are in only one condition. The function
<code>crossing</code> gives you a data frame with all possible
combinations of the arguments. Add the data specific to each subject and
stimulus by left joining the <code>sub</code> and <code>stim</code> data
frames.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>
  sub_id <span class="op">=</span> <span class="va">sub</span><span class="op">$</span><span class="va">sub_id</span>, <span class="co"># get subject IDs from the sub data table</span>
  stim_id <span class="op">=</span> <span class="va">stim</span><span class="op">$</span><span class="va">stim_id</span>, <span class="co"># get stimulus IDs from the stim data table</span>
  stim_version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span> <span class="co"># all subjects see both congruent and incongruent versions of all stimuli</span>
<span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sub</span>, by <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># includes the intercept and conditin for each subject</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stim</span>, by <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span>   <span class="co"># includes the intercept for each stimulus</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="calculate-dv">Calculate DV<a class="anchor" aria-label="anchor" href="#calculate-dv"></a>
</h2>
<p>Now we can calculate the DV by adding together an overall intercept
(mean RT for all trials), the subject-specific intercept, the
stimulus-specific intercept, the effect of subject condition, the
interaction between condition and version (set to 0 for this first
example), the effect of stimulus version, and an error term.</p>
<div class="section level3">
<h3 id="fixed-effects">Fixed effects<a class="anchor" aria-label="anchor" href="#fixed-effects"></a>
</h3>
<p>We set these effects in raw units (ms) and effect-code the subject
condition and stimulus version. It’s usually easiest to interpret if you
recode the level that you predict will be larger as +0.5 and the level
you predict will be smaller as -0.5. So when we set the effect of
subject condition (<code>sub_cond_eff</code>) to 50, that means the
average difference between the easy and hard condition is 50ms.
<code>Easy</code> is effect-coded as -0.5 and <code>hard</code> is
effect-coded as +0.5, which means that trials in the easy condition have
-0.5 * 50ms (i.e., -25ms) added to their reaction time, while trials in
the hard condition have +0.5 * 50ms (i.e., +25ms) added to their
reaction time.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set variables to use in calculations below</span>
<span class="va">grand_i</span>          <span class="op">&lt;-</span> <span class="fl">400</span> <span class="co"># overall mean DV</span>
<span class="va">sub_cond_eff</span>     <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between conditions: hard - easy</span>
<span class="va">stim_version_eff</span> <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between versions: incongruent - congruent</span>
<span class="va">cond_version_ixn</span> <span class="op">&lt;-</span>  <span class="fl">0</span>  <span class="co"># interaction between version and condition</span>
<span class="va">error_sd</span>         <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></code></pre></div>
<p>The code chunk below effect-codes the condition and version factors
(important for the analysis below), generates an error term for each
trial, and generates the DV.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"hard"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
<span class="va">versions</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"incongruent"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">trials</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    <span class="co"># effect-code subject condition and stimulus version</span>
    sub_cond.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">conditions</span><span class="op">)</span>,
    stim_version.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">stim_version</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">versions</span><span class="op">)</span>,
    <span class="co"># calculate error term (normally distributed residual with SD set above)</span>
    err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">error_sd</span><span class="op">)</span>,
    <span class="co"># calculate DV from intercepts, effects, and error</span>
    dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span>
         <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">sub_cond_eff</span><span class="op">)</span> <span class="op">+</span> 
         <span class="op">(</span><span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">stim_version_eff</span><span class="op">)</span> <span class="op">+</span> 
         <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">cond_version_ixn</span><span class="op">)</span> <span class="co"># in this example, this is always 0 and could be omitted</span>
  <span class="op">)</span></code></pre></div>
<p>As always, graph to make sure you’ve simulated the general pattern
you expected.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="va">dv</span>, color <span class="op">=</span> <span class="va">stim_version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-dv-1.png" alt="Double-check the simulated pattern" width="100%"><p class="caption">
Double-check the simulated pattern
</p>
</div>
</div>
<div class="section level3">
<h3 id="interactions">Interactions<a class="anchor" aria-label="anchor" href="#interactions"></a>
</h3>
<p>If you want to simulate an interaction, it can be tricky to figure
out what to set the main effects and interaction effect to. It can be
easier to think about the simple main effects for each cell. Create four
new variables and set them to the deviations from the overall mean you’d
expect for each condition (so they should add up to 0). Here, we’re
simulating a small effect of version in the hard condition (50ms
difference) and double that effect of version in the easy condition
(100ms difference).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set variables to use in calculations below</span>
<span class="va">grand_i</span>    <span class="op">&lt;-</span> <span class="fl">400</span>
<span class="va">hard_congr</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">25</span>
<span class="va">hard_incon</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">25</span>
<span class="va">easy_congr</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span>
<span class="va">easy_incon</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">50</span>
<span class="va">error_sd</span>   <span class="op">&lt;-</span>  <span class="fl">25</span>

<span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"hard"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
<span class="va">versions</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"incongruent"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p>Use the code below to transform the simple main effects above into
main effects and interactions for use in the equations below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate main effects and interactions from simple effects above</span>

<span class="co"># mean difference between easy and hard conditions</span>
<span class="va">sub_cond_eff</span>     <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hard_congr</span> <span class="op">+</span> <span class="va">hard_incon</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span>
                    <span class="op">(</span><span class="va">easy_congr</span> <span class="op">+</span> <span class="va">easy_incon</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>

<span class="co"># mean difference between incongruent and congruent versions</span>
<span class="va">stim_version_eff</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hard_incon</span> <span class="op">+</span> <span class="va">easy_incon</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> 
                    <span class="op">(</span><span class="va">hard_congr</span> <span class="op">+</span> <span class="va">easy_congr</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>

<span class="co"># interaction between version and condition</span>
<span class="va">cond_version_ixn</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hard_incon</span> <span class="op">-</span> <span class="va">hard_congr</span><span class="op">)</span> <span class="op">-</span>
                    <span class="op">(</span><span class="va">easy_incon</span> <span class="op">-</span> <span class="va">easy_congr</span><span class="op">)</span></code></pre></div>
<p>Then generate the DV the same way we did above, but also add the
interaction effect multiplied by the effect-coded subject condition and
stimulus version.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">trials</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    <span class="co"># effect-code subject condition and stimulus version</span>
    sub_cond.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">conditions</span><span class="op">)</span>,
    stim_version.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">stim_version</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">versions</span><span class="op">)</span>,
    <span class="co"># calculate error term (normally distributed residual with SD set above)</span>
    err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">error_sd</span><span class="op">)</span>,
    <span class="co"># calculate DV from intercepts, effects, and error</span>
    dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span>
         <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">sub_cond_eff</span><span class="op">)</span> <span class="op">+</span> 
         <span class="op">(</span><span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">stim_version_eff</span><span class="op">)</span> <span class="op">+</span> 
         <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">cond_version_ixn</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="va">dv</span>, color <span class="op">=</span> <span class="va">stim_version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-ixn-1.png" alt="Double-check the interaction between condition and version" width="100%"><p class="caption">
Double-check the interaction between condition and version
</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">sub_cond</span>, <span class="va">stim_version</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dv</span><span class="op">)</span> <span class="op">-</span> <span class="va">grand_i</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span><span class="va">stim_version</span>, <span class="va">m</span><span class="op">)</span>
<span class="co">## <span style="color: #949494;"># A tibble: 2 × 3</span></span>
<span class="co">##   sub_cond congruent incongruent</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> easy         -<span style="color: #BB0000;">42.5</span>        57.1</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> hard         -<span style="color: #BB0000;">28.5</span>        21.7</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>New we will run a linear mixed effects model with <code>lmer</code>
and look at the summary.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">+</span>
              <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sub_id</span><span class="op">)</span> <span class="op">+</span> 
              <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">stim_id</span><span class="op">)</span>,
            data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>

<span class="va">mod.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>

<span class="va">mod.sum</span>
<span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span>
<span class="co">## lmerModLmerTest]</span>
<span class="co">## Formula: dv ~ sub_cond.e * stim_version.e + (1 | sub_id) + (1 | stim_id)</span>
<span class="co">##    Data: dat</span>
<span class="co">## </span>
<span class="co">## REML criterion at convergence: 187453</span>
<span class="co">## </span>
<span class="co">## Scaled residuals: </span>
<span class="co">##    Min     1Q Median     3Q    Max </span>
<span class="co">## -3.760 -0.663  0.006  0.659  3.714 </span>
<span class="co">## </span>
<span class="co">## Random effects:</span>
<span class="co">##  Groups   Name        Variance Std.Dev.</span>
<span class="co">##  sub_id   (Intercept) 9184     95.8    </span>
<span class="co">##  stim_id  (Intercept) 3068     55.4    </span>
<span class="co">##  Residual              629     25.1    </span>
<span class="co">## Number of obs: 20000, groups:  sub_id, 200; stim_id, 50</span>
<span class="co">## </span>
<span class="co">## Fixed effects:</span>
<span class="co">##                            Estimate Std. Error        df t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)                 401.937     10.359   131.476   38.80   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e                  -10.737     13.557   198.000   -0.79     0.43    </span>
<span class="co">## stim_version.e               74.908      0.355 19749.000  211.19   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e:stim_version.e   -49.357      0.709 19749.000  -69.57   &lt;2e-16 ***</span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Correlation of Fixed Effects:</span>
<span class="co">##             (Intr) sb_cn. stm_v.</span>
<span class="co">## sub_cond.e  0.000               </span>
<span class="co">## stim_versn. 0.000  0.000        </span>
<span class="co">## sb_cnd.:s_. 0.000  0.000  0.000</span></code></pre></div>
<div class="section level3">
<h3 id="sense-checks">Sense checks<a class="anchor" aria-label="anchor" href="#sense-checks"></a>
</h3>
<p>First, check that your groups make sense.</p>
<ul>
<li>The number of obs should be the total number of trials
analysed.</li>
<li>
<code>sub_id</code> should be what we set <code>sub_n</code> to
above.</li>
<li>
<code>stim_id</code> should be what we set <code>stim_n</code> to
above.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod.sum</span><span class="op">$</span><span class="va">ngrps</span>
<span class="co">##  sub_id stim_id </span>
<span class="co">##     200      50</span></code></pre></div>
<p>Next, look at the random effects.</p>
<ul>
<li>The SD for <code>sub_id</code> should be near
<code>sub_sd</code>.</li>
<li>The SD for <code>stim_id</code> should be near
<code>stim_sd</code>.</li>
<li>The residual SD should be near <code>error_sd</code>.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod.sum</span><span class="op">$</span><span class="va">varcor</span>
<span class="co">##  Groups   Name        Std.Dev.</span>
<span class="co">##  sub_id   (Intercept) 95.8    </span>
<span class="co">##  stim_id  (Intercept) 55.4    </span>
<span class="co">##  Residual             25.1</span></code></pre></div>
<p>Finally, look at the fixed effects.</p>
<ul>
<li>The estimate for the Intercept should be near the
<code>grand_i</code>.</li>
<li>The main effect of <code>sub_cond.e</code> should be near what we
calculated for <code>sub_cond_eff</code>.</li>
<li>The main effect of <code>stim_version.e</code> should be near what
we calculated for <code>stim_version_eff</code>.</li>
<li>The interaction between
<code>sub_cond.e</code>:<code>stim_version.e</code> should be near what
we calculated for <code>cond_version_ixn</code>.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod.sum</span><span class="op">$</span><span class="va">coefficients</span>
<span class="co">##                           Estimate Std. Error      df t value  Pr(&gt;|t|)</span>
<span class="co">## (Intercept)                 401.94    10.3595   131.5  38.799 7.348e-74</span>
<span class="co">## sub_cond.e                  -10.74    13.5573   198.0  -0.792 4.293e-01</span>
<span class="co">## stim_version.e               74.91     0.3547 19749.0 211.185 0.000e+00</span>
<span class="co">## sub_cond.e:stim_version.e   -49.36     0.7094 19749.0 -69.575 0.000e+00</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-effects">Random effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h3>
<p>Plot the subject intercepts from our code above
(<code>sub$sub_i</code>) against the subject intercepts calculcated by
<code>lmer</code> (<code>ranef(mod)$sub_id</code>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/ranef.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">sub_id</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_sub_i <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sub_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">sub_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sub</span>, by <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sub_i</span>,<span class="va">mod_sub_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Simulated random intercepts (sub_i)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Modeled random intercepts"</span><span class="op">)</span>
<span class="co">## `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-sub-ranef-1.png" alt="Compare simulated subject random intercepts to those from the model" width="100%"><p class="caption">
Compare simulated subject random intercepts to those from the model
</p>
</div>
<p>Plot the stimulus intercepts from our code above
(<code>stim$stim_i</code>) against the stimulus intercepts calculcated
by <code>lmer</code> (<code>ranef(mod)$stim_id</code>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/ranef.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">stim_id</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_stim_i <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stim_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">stim_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stim</span>, by <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">stim_i</span>,<span class="va">mod_stim_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Simulated random intercepts (stim_i)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Modeled random intercepts"</span><span class="op">)</span>
<span class="co">## `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-stim-ranef-1.png" alt="Compare simulated stimulus random intercepts to those from the model" width="100%"><p class="caption">
Compare simulated stimulus random intercepts to those from the model
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="function">Function<a class="anchor" aria-label="anchor" href="#function"></a>
</h2>
<p>You can put the code above in a function so you can run it more
easily and change the parameters. I removed the plot and set the
argument defaults to the same as the example above with all fixed
effects set to 0, but you can set them to other patterns.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_lmer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">sub_n</span> <span class="op">=</span> <span class="fl">200</span>,
                      <span class="va">sub_sd</span> <span class="op">=</span> <span class="fl">100</span>,
                      <span class="va">stim_n</span> <span class="op">=</span> <span class="fl">50</span>,
                      <span class="va">stim_sd</span> <span class="op">=</span> <span class="fl">50</span>,
                      <span class="va">grand_i</span> <span class="op">=</span> <span class="fl">400</span>,
                      <span class="va">sub_cond_eff</span> <span class="op">=</span> <span class="fl">0</span>,
                      <span class="va">stim_version_eff</span> <span class="op">=</span> <span class="fl">0</span>, 
                      <span class="va">cond_version_ixn</span> <span class="op">=</span> <span class="fl">0</span>,
                      <span class="va">error_sd</span> <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
    sub_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">sub_n</span>,
    sub_i  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sub_n</span>, <span class="fl">0</span>, <span class="va">sub_sd</span><span class="op">)</span>,
    sub_cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hard"</span>,<span class="st">"easy"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sub_n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">stim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
    stim_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">stim_n</span>,
    stim_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">stim_n</span>, <span class="fl">0</span>, <span class="va">stim_sd</span><span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"hard"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
  <span class="va">versions</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"incongruent"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
  
  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>
    sub_id <span class="op">=</span> <span class="va">sub</span><span class="op">$</span><span class="va">sub_id</span>,
    stim_id <span class="op">=</span> <span class="va">stim</span><span class="op">$</span><span class="va">stim_id</span>,
    stim_version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sub</span>, by <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stim</span>, by <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      <span class="co"># effect-code subject condition and stimulus version</span>
      sub_cond.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">conditions</span><span class="op">)</span>,
      stim_version.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">stim_version</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">versions</span><span class="op">)</span>,
      <span class="co"># calculate error term (normally distributed residual with SD set above)</span>
      err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">error_sd</span><span class="op">)</span>,
      <span class="co"># calculate DV from intercepts, effects, and error</span>
      dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span>
           <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">sub_cond_eff</span><span class="op">)</span> <span class="op">+</span> 
           <span class="op">(</span><span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">stim_version_eff</span><span class="op">)</span> <span class="op">+</span> 
           <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">cond_version_ixn</span><span class="op">)</span>
    <span class="op">)</span>
  
  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">+</span>
                <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sub_id</span><span class="op">)</span> <span class="op">+</span> 
                <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">stim_id</span><span class="op">)</span>,
              data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Run the function with the default values (so all fixed effects set to
0).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">sim_lmer</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span>
<span class="co">## lmerModLmerTest]</span>
<span class="co">## Formula: dv ~ sub_cond.e * stim_version.e + (1 | sub_id) + (1 | stim_id)</span>
<span class="co">##    Data: dat</span>
<span class="co">## </span>
<span class="co">## REML criterion at convergence: 187436</span>
<span class="co">## </span>
<span class="co">## Scaled residuals: </span>
<span class="co">##    Min     1Q Median     3Q    Max </span>
<span class="co">## -4.317 -0.673  0.001  0.662  4.808 </span>
<span class="co">## </span>
<span class="co">## Random effects:</span>
<span class="co">##  Groups   Name        Variance Std.Dev.</span>
<span class="co">##  sub_id   (Intercept) 8822     93.9    </span>
<span class="co">##  stim_id  (Intercept) 2680     51.8    </span>
<span class="co">##  Residual              629     25.1    </span>
<span class="co">## Number of obs: 20000, groups:  sub_id, 200; stim_id, 50</span>
<span class="co">## </span>
<span class="co">## Fixed effects:</span>
<span class="co">##                            Estimate Std. Error        df t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)                 390.831      9.886   139.365   39.53   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e                   12.415     13.287   197.997    0.93     0.35    </span>
<span class="co">## stim_version.e               -0.178      0.355 19749.003   -0.50     0.62    </span>
<span class="co">## sub_cond.e:stim_version.e     0.351      0.709 19749.003    0.50     0.62    </span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Correlation of Fixed Effects:</span>
<span class="co">##             (Intr) sb_cn. stm_v.</span>
<span class="co">## sub_cond.e  0.000               </span>
<span class="co">## stim_versn. 0.000  0.000        </span>
<span class="co">## sb_cnd.:s_. 0.000  0.000  0.000</span></code></pre></div>
<p>Try changing some variables to simulate different patterns of fixed
effects.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">sim_lmer</span><span class="op">(</span>sub_cond_eff <span class="op">=</span> <span class="fl">0</span>,
         stim_version_eff <span class="op">=</span> <span class="fl">75</span>, 
         cond_version_ixn <span class="op">=</span> <span class="op">-</span><span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span>
<span class="co">## lmerModLmerTest]</span>
<span class="co">## Formula: dv ~ sub_cond.e * stim_version.e + (1 | sub_id) + (1 | stim_id)</span>
<span class="co">##    Data: dat</span>
<span class="co">## </span>
<span class="co">## REML criterion at convergence: 187254</span>
<span class="co">## </span>
<span class="co">## Scaled residuals: </span>
<span class="co">##    Min     1Q Median     3Q    Max </span>
<span class="co">## -4.147 -0.663  0.000  0.669  3.997 </span>
<span class="co">## </span>
<span class="co">## Random effects:</span>
<span class="co">##  Groups   Name        Variance Std.Dev.</span>
<span class="co">##  sub_id   (Intercept) 11708    108.2   </span>
<span class="co">##  stim_id  (Intercept)  2721     52.2   </span>
<span class="co">##  Residual               621     24.9   </span>
<span class="co">## Number of obs: 20000, groups:  sub_id, 200; stim_id, 50</span>
<span class="co">## </span>
<span class="co">## Fixed effects:</span>
<span class="co">##                            Estimate Std. Error        df t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)                 407.692     10.629   164.036   38.36   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e                    7.750     15.306   198.000    0.51     0.61    </span>
<span class="co">## stim_version.e               74.932      0.353 19749.000  212.55   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e:stim_version.e   -50.556      0.705 19749.000  -71.70   &lt;2e-16 ***</span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Correlation of Fixed Effects:</span>
<span class="co">##             (Intr) sb_cn. stm_v.</span>
<span class="co">## sub_cond.e  0.000               </span>
<span class="co">## stim_versn. 0.000  0.000        </span>
<span class="co">## sb_cnd.:s_. 0.000  0.000  0.000</span></code></pre></div>
<div class="section level3">
<h3 id="power-analysis">Power analysis<a class="anchor" aria-label="anchor" href="#power-analysis"></a>
</h3>
<p>First, wrap your simulation function inside of another function that
takes the argument of a replication number, runs a simluated analysis,
and returns a data table of the fixed and random effects (made with
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom.mixed::tidy()</a></code>). You can use purrr’s
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df()</a></code> function to create a data table of results from
multiple replications of this function. We’re only running 10
replications here in the interests of time, but you’ll want to run 100
or more for a proper power calculation.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">sim_lmer_pwr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rep</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">sim_lmer</span><span class="op">(</span>sub_cond_eff <span class="op">=</span> <span class="fl">0</span>,
                stim_version_eff <span class="op">=</span> <span class="fl">75</span>, 
                cond_version_ixn <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
  
  <span class="co"># put just the fixed effects into a data table</span>
  <span class="fu">broom.mixed</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"fixed"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rep <span class="op">=</span> <span class="va">rep</span><span class="op">)</span> <span class="co"># add a column for which rep</span>
<span class="op">}</span>

<span class="va">my_power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">sim_lmer_pwr</span><span class="op">)</span></code></pre></div>
<p>You can then plot the distribution of estimates across your
simulations.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">my_power</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">estimate</span>, color <span class="op">=</span> <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<p><img src="mixed_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<p>You can also just calculate power as the proportion of p-values less
than your alpha.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_power</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span>,
            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>
<span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span>
<span class="co">##   term                      power</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)                   1</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> stim_version.e                1</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> sub_cond.e                    0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> sub_cond.e:stim_version.e     1</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="random-slopes">Random slopes<a class="anchor" aria-label="anchor" href="#random-slopes"></a>
</h2>
<p>In the example so far we’ve ignored random variation among subjects
or stimuli in the size of the fixed effects (i.e., <strong>random
slopes</strong>).</p>
<p>First, let’s reset the parameters we set above.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub_n</span>            <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># number of subjects in this simulation</span>
<span class="va">sub_sd</span>           <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># SD for the subjects' random intercept</span>
<span class="va">stim_n</span>           <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># number of stimuli in this simulation</span>
<span class="va">stim_sd</span>          <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># SD for the stimuli's random intercept</span>
<span class="va">grand_i</span>          <span class="op">&lt;-</span> <span class="fl">400</span> <span class="co"># overall mean DV</span>
<span class="va">sub_cond_eff</span>     <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between conditions: hard - easy</span>
<span class="va">stim_version_eff</span> <span class="op">&lt;-</span> <span class="fl">50</span>  <span class="co"># mean difference between versions: incongruent - congruent</span>
<span class="va">cond_version_ixn</span> <span class="op">&lt;-</span>  <span class="fl">0</span>  <span class="co"># interaction between version and condition</span>
<span class="va">error_sd</span>         <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># residual (error) SD</span></code></pre></div>
<div class="section level3">
<h3 id="subjects-1">Subjects<a class="anchor" aria-label="anchor" href="#subjects-1"></a>
</h3>
<p>In addition to generating a random intercept for each subject, now we
will also generate a random slope for any within-subject factors. The
only within-subject factor in this design is <code>stim_version</code>.
The main effect of <code>stim_version</code> is set to 50 above, but
different subjects will show variation in the size of this effect.
That’s what the random slope captures. We’ll set
<code>sub_version_sd</code> below to the SD of this variation and use
this to calculate the random slope (<code>sub_version_slope</code>) for
each subject.</p>
<p>Also, it’s likely that the variation between subjects in the size of
the effect of version is related in some way to between-subject
variation in the intercept. So we want the random intercept and slope to
be correlated. Here, we’ll simulate a case where subjects who have
slower (larger) reaction times across the board show a smaller effect of
condition, so we set <code>sub_i_version_cor</code> below to a negative
number (-0.2).</p>
<p>The code below creates two variables (<code>sub_i</code>,
<code>sub_version_slope</code>) that are correlated with r = -0.2, means
of 0, and SDs equal to what we set <code>sub_sd</code> above and
<code>sub_version_sd</code> below.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub_version_sd</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">sub_i_version_cor</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.2</span>

<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu">faux</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/faux/man/rnorm_multi.html" class="external-link">rnorm_multi</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="va">sub_n</span>, 
  r <span class="op">=</span> <span class="va">sub_i_version_cor</span>,
  mu <span class="op">=</span> <span class="fl">0</span>, <span class="co"># means of random intercepts and slopes are always 0</span>
  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sub_sd</span>, <span class="va">sub_version_sd</span><span class="op">)</span>,
  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sub_i"</span>, <span class="st">"sub_version_slope"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    sub_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">sub_n</span>,
    sub_cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sub_n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="co"># between-subjects factor</span>
  <span class="op">)</span></code></pre></div>
<p>Plot to double-check it looks sensible.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sub</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sub_i</span>, <span class="va">sub_version_slope</span>, color <span class="op">=</span> <span class="va">sub_cond</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/plot-subject-slope-cor-1.png" alt="Double-check slope-intercept correlations" width="100%"><p class="caption">
Double-check slope-intercept correlations
</p>
</div>
</div>
<div class="section level3">
<h3 id="stimuli-1">Stimuli<a class="anchor" aria-label="anchor" href="#stimuli-1"></a>
</h3>
<p>In addition to generating a random intercept for each stimulus, we
will also generate a random slope for any within-stimulus factors. Both
<code>stim_version</code> and <code>sub_condition</code> are
within-stimulus factors (i.e., all stimuli are seen in both
<code>congruent</code> and <code>incongruent</code> versions and both
<code>easy</code> and <code>hard</code> conditions). So the main effects
of version and condition (and their interaction) will vary depending on
the stimulus.</p>
<p>They will also be correlated, but in a more complex way than above.
You need to set the correlations for all pairs of slopes and intercept.
Let’s set the correlation between the random intercept and each of the
slopes to -0.4 and the slopes all correlate with each other +0.2 (You
could set each of the six correlations separately if you want,
though).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">stim_version_sd</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># SD for the stimuli's random slope for stim_version</span>
<span class="va">stim_cond_sd</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># SD for the stimuli's random slope for sub_cond</span>
<span class="va">stim_cond_version_sd</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># SD for the stimuli's random slope for sub_cond:stim_version</span>
<span class="va">stim_i_cor</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.4</span> <span class="co"># correlations between intercept and slopes</span>
<span class="va">stim_s_cor</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">0.2</span> <span class="co"># correlations among slopes</span>

<span class="co"># specify correlations for rnorm_multi (one of several methods)</span>
<span class="va">stim_cors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>,
                           <span class="va">stim_s_cor</span>, <span class="va">stim_s_cor</span>,
                                       <span class="va">stim_s_cor</span><span class="op">)</span>
<span class="va">stim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/rnorm_multi.html" class="external-link">rnorm_multi</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="va">stim_n</span>, 
  r <span class="op">=</span> <span class="va">stim_cors</span>, 
  mu <span class="op">=</span> <span class="fl">0</span>, <span class="co"># means of random intercepts and slopes are always 0</span>
  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_sd</span>, <span class="va">stim_version_sd</span>, <span class="va">stim_cond_sd</span>, <span class="va">stim_cond_version_sd</span><span class="op">)</span>,
  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stim_i"</span>, <span class="st">"stim_version_slope"</span>, <span class="st">"stim_cond_slope"</span>, <span class="st">"stim_cond_version_slope"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    stim_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">stim_n</span>
  <span class="op">)</span></code></pre></div>
<p>Check your stimulated data using faux’s
<code><a href="https://rdrr.io/pkg/faux/man/get_params.html" class="external-link">check_sim_stats()</a></code> function. Here, we’re simulating
different SDs for different effects, so our summary table should reflect
this.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">stim</span>, <span class="op">-</span><span class="va">stim_id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># remove id</span>
  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/get_params.html" class="external-link">check_sim_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>    <span class="co"># calculates means, SDs and correlations</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">3</span>, v <span class="op">=</span> <span class="fl">4</span>, c <span class="op">=</span> <span class="fl">5</span>, cv <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="co"># rename columns to fit width</span>
<span class="co">##    n                     var     i     v     c    cv  mean    sd</span>
<span class="co">## 1 50                  stim_i  1.00 -0.49 -0.07 -0.35  8.14 44.95</span>
<span class="co">## 2 50      stim_version_slope -0.49  1.00 -0.06  0.30 -0.58  9.65</span>
<span class="co">## 3 50         stim_cond_slope -0.07 -0.06  1.00 -0.07 -0.69 25.71</span>
<span class="co">## 4 50 stim_cond_version_slope -0.35  0.30 -0.07  1.00  0.99 13.76</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="trials-1">Trials<a class="anchor" aria-label="anchor" href="#trials-1"></a>
</h3>
<p>Now we put the subjects and stimuli together in the same way as
before.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>
  sub_id <span class="op">=</span> <span class="va">sub</span><span class="op">$</span><span class="va">sub_id</span>, <span class="co"># get subject IDs from the sub data table</span>
  stim_id <span class="op">=</span> <span class="va">stim</span><span class="op">$</span><span class="va">stim_id</span>, <span class="co"># get stimulus IDs from the stim data table</span>
  stim_version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span> <span class="co"># all subjects see both congruent and incongruent versions of all stimuli</span>
<span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sub</span>, by <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># includes the intercept, slope, and conditin for each subject</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stim</span>, by <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span>   <span class="co"># includes the intercept and slopes for each stimulus</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="calculate-dv-1">Calculate DV<a class="anchor" aria-label="anchor" href="#calculate-dv-1"></a>
</h2>
<p>Now we can calculate the DV by adding together an overall intercept
(mean RT for all trials), the subject-specific intercept, the
stimulus-specific intercept, the effect of subject condition, the
stimulus-specific slope for condition, the effect of stimulus version,
the stimulus-specific slope for version, the subject-specific slope for
condition, the interaction between condition and version (set to 0 for
this example), the stimulus-specific slope for the interaction between
condition and version, and an error term.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"hard"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
<span class="va">versions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"incongruent"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">trials</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    <span class="co"># effect-code subject condition and stimulus version</span>
    sub_cond.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">conditions</span><span class="op">)</span>,
    stim_version.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">stim_version</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">versions</span><span class="op">)</span>,
    <span class="co"># calculate trial-specific effects by adding overall effects and slopes</span>
    cond_eff <span class="op">=</span> <span class="va">sub_cond_eff</span> <span class="op">+</span> <span class="va">stim_cond_slope</span>,
    version_eff <span class="op">=</span> <span class="va">stim_version_eff</span> <span class="op">+</span> <span class="va">stim_version_slope</span> <span class="op">+</span> <span class="va">sub_version_slope</span>,
    cond_version_eff <span class="op">=</span> <span class="va">cond_version_ixn</span> <span class="op">+</span> <span class="va">stim_cond_version_slope</span>,
    <span class="co"># calculate error term (normally distributed residual with SD set above)</span>
    err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">error_sd</span><span class="op">)</span>,
    <span class="co"># calculate DV from intercepts, effects, and error</span>
    dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span>
         <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> 
         <span class="op">(</span><span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">version_eff</span><span class="op">)</span> <span class="op">+</span> 
         <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">cond_version_eff</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>As always, graph to make sure you’ve simulated the general pattern
you expected.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="va">dv</span>, color <span class="op">=</span> <span class="va">stim_version</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">grand_i</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="mixed_files/figure-html/rslope-plot-dv-1.png" alt="Double-check the simulated pattern" width="100%"><p class="caption">
Double-check the simulated pattern
</p>
</div>
</div>
<div class="section level2">
<h2 id="analysis-1">Analysis<a class="anchor" aria-label="anchor" href="#analysis-1"></a>
</h2>
<p>New we’ll run a linear mixed effects model with <code>lmer</code> and
look at the summary. You specify random slopes by adding the
within-level effects to the random intercept specifications. Since the
only within-subject factor is version, the random effects specification
for subjects is <code>(1 + stim_version.e | sub_id)</code>. Since both
condition and version are within-stimuli factors, the random effects
specification for stimuli is
<code>(1 + stim_version.e*sub_cond.e | stim_id)</code>.</p>
<p>This model will take a lot longer to run than one without random
slopes specified. This might be a good time for a coffee break.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">+</span>
              <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">stim_version.e</span> <span class="op">||</span> <span class="va">sub_id</span><span class="op">)</span> <span class="op">+</span> 
              <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">stim_version.e</span><span class="op">*</span><span class="va">sub_cond.e</span> <span class="op">||</span> <span class="va">stim_id</span><span class="op">)</span>,
            data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>

<span class="va">mod.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>

<span class="va">mod.sum</span>
<span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span>
<span class="co">## lmerModLmerTest]</span>
<span class="co">## Formula: dv ~ sub_cond.e * stim_version.e + (1 + stim_version.e || sub_id) +  </span>
<span class="co">##     (1 + stim_version.e * sub_cond.e || stim_id)</span>
<span class="co">##    Data: dat</span>
<span class="co">## </span>
<span class="co">## REML criterion at convergence: 188295</span>
<span class="co">## </span>
<span class="co">## Scaled residuals: </span>
<span class="co">##    Min     1Q Median     3Q    Max </span>
<span class="co">## -3.783 -0.668  0.001  0.671  3.643 </span>
<span class="co">## </span>
<span class="co">## Random effects:</span>
<span class="co">##  Groups    Name                      Variance Std.Dev.</span>
<span class="co">##  sub_id    (Intercept)               12778.1  113.04  </span>
<span class="co">##  sub_id.1  stim_version.e              386.4   19.66  </span>
<span class="co">##  stim_id   (Intercept)                2017.6   44.92  </span>
<span class="co">##  stim_id.1 stim_version.e               89.3    9.45  </span>
<span class="co">##  stim_id.2 sub_cond.e                  679.4   26.06  </span>
<span class="co">##  stim_id.3 stim_version.e:sub_cond.e   193.9   13.93  </span>
<span class="co">##  Residual                              621.8   24.94  </span>
<span class="co">## Number of obs: 20000, groups:  sub_id, 200; stim_id, 50</span>
<span class="co">## </span>
<span class="co">## Fixed effects:</span>
<span class="co">##                           Estimate Std. Error      df t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)                411.351     10.211 201.629   40.28   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e                  42.040     16.410 217.091    2.56    0.011 *  </span>
<span class="co">## stim_version.e              47.707      1.960 154.029   24.34   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e:stim_version.e    0.782      3.479 199.995    0.22    0.822    </span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Correlation of Fixed Effects:</span>
<span class="co">##             (Intr) sb_cn. stm_v.</span>
<span class="co">## sub_cond.e  0.000               </span>
<span class="co">## stim_versn. 0.000  0.000        </span>
<span class="co">## sb_cnd.:s_. 0.000  0.000  0.000</span></code></pre></div>
<div class="section level3">
<h3 id="sense-checks-1">Sense checks<a class="anchor" aria-label="anchor" href="#sense-checks-1"></a>
</h3>
<p>First, check that your groups make sense.</p>
<ul>
<li>
<code>sub_id</code> = <code>sub_n</code> (200)</li>
<li>
<code>stim_id</code> = <code>stim_n</code> (50)</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod.sum</span><span class="op">$</span><span class="va">ngrps</span>
<span class="co">##  sub_id stim_id </span>
<span class="co">##     200      50</span></code></pre></div>
<p>Next, look at the SDs for the random effects.</p>
<ul>
<li>Group:<code>sub_id</code>
<ul>
<li>
<code>(Intercept)</code> ~= <code>sub_sd</code>
</li>
<li>
<code>stim_version.e</code> ~= <code>sub_version_sd</code>
</li>
</ul>
</li>
<li>Group: <code>stim_id</code>
<ul>
<li>
<code>(Intercept)</code> ~= <code>stim_sd</code>
</li>
<li>
<code>stim_version.e</code> ~= <code>stim_version_sd</code>
</li>
<li>
<code>sub_cond.e</code> ~= <code>stim_cond_sd</code>
</li>
<li>
<code>stim_version.e:sub_cond.e</code> ~=
<code>stim_cond_version_sd</code>
</li>
</ul>
</li>
<li>Residual ~= <code>error_sd</code>
</li>
</ul>
<p>The correlations are a bit more difficult to parse. The first column
under <code>Corr</code> shows the correlation between the random slope
for that row and the random intercept. So for
<code>stim_version.e</code> under <code>sub_id</code>, the correlation
should be close to <code>sub_i_version_cor</code>. For all three random
slopes under <code>stim_id</code>, the correlation with the random
intercept should be near <code>stim_i_cor</code> and their correlations
with each other should be near <code>stim_s_cor</code>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod.sum</span><span class="op">$</span><span class="va">varcor</span>
<span class="co">##  Groups    Name                      Std.Dev.</span>
<span class="co">##  sub_id    (Intercept)               113.04  </span>
<span class="co">##  sub_id.1  stim_version.e             19.66  </span>
<span class="co">##  stim_id   (Intercept)                44.92  </span>
<span class="co">##  stim_id.1 stim_version.e              9.45  </span>
<span class="co">##  stim_id.2 sub_cond.e                 26.06  </span>
<span class="co">##  stim_id.3 stim_version.e:sub_cond.e  13.93  </span>
<span class="co">##  Residual                             24.94</span></code></pre></div>
<p>Finally, look at the fixed effects.</p>
<ul>
<li>
<code>(Intercept)</code> ~= <code>grand_i</code>
</li>
<li>
<code>sub_cond.e</code> ~= <code>sub_cond_eff</code>
</li>
<li>
<code>stim_version.e</code> ~= <code>stim_version_eff</code>
</li>
<li>
<code>sub_cond.e</code>:<code>stim_version.e</code> ~=
<code>cond_version_ixn</code>
</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod.sum</span><span class="op">$</span><span class="va">coefficients</span>
<span class="co">##                           Estimate Std. Error    df t value  Pr(&gt;|t|)</span>
<span class="co">## (Intercept)               411.3507     10.211 201.6 40.2834 2.182e-98</span>
<span class="co">## sub_cond.e                 42.0404     16.410 217.1  2.5619 1.109e-02</span>
<span class="co">## stim_version.e             47.7065      1.960 154.0 24.3351 1.206e-54</span>
<span class="co">## sub_cond.e:stim_version.e   0.7823      3.479 200.0  0.2249 8.223e-01</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-effects-1">Random effects<a class="anchor" aria-label="anchor" href="#random-effects-1"></a>
</h3>
<p>Compare the subject intercepts and slopes from our code above
(<code>sub$sub_i</code>) against the subject intercepts and slopes
calculcated by <code>lmer</code> (<code>ranef(mod)$sub_id</code>).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/ranef.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">sub_id</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_i <span class="op">=</span> <span class="va">`(Intercept)`</span>,
         mod_version_slope <span class="op">=</span> <span class="va">stim_version.e</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sub_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">sub_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sub</span>, by <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mod_i</span>, <span class="va">sub_i</span>, 
         <span class="va">mod_version_slope</span>,  <span class="va">sub_version_slope</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/get_params.html" class="external-link">get_params</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>    <span class="co"># calculates means, SDs and correlations</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_v <span class="op">=</span> <span class="fl">5</span>, sub_v <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># rename columns to fit width</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">var</span>, <span class="va">mod_i</span>, <span class="va">mod_v</span>, <span class="va">sub_i</span>, <span class="va">sub_v</span>, <span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span>
<span class="co">##     n               var mod_i mod_v sub_i sub_v  mean     sd</span>
<span class="co">## 1 200             mod_i  1.00 -0.17  1.00 -0.18  0.00 112.73</span>
<span class="co">## 2 200             sub_i  1.00 -0.17  1.00 -0.18  3.15 113.00</span>
<span class="co">## 3 200 mod_version_slope -0.17  1.00 -0.17  0.96  0.00  19.00</span>
<span class="co">## 4 200 sub_version_slope -0.18  0.96 -0.18  1.00 -1.18  19.52</span></code></pre></div>
<p>Compare the stimulus intercepts and slopes from our code above
(<code>stim$stim_i</code>) against the stimulus intercepts and slopes
calculated by <code>lmer</code> (<code>ranef(mod)$stim_id</code>).</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/ranef.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">stim_id</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_i <span class="op">=</span> <span class="va">`(Intercept)`</span>,
         mod_version_slope <span class="op">=</span> <span class="va">stim_version.e</span>,
         mod_cond_slope <span class="op">=</span> <span class="va">sub_cond.e</span>,
         mod_cond_version_slope <span class="op">=</span> <span class="va">`stim_version.e:sub_cond.e`</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stim_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">stim_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stim</span>, by <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mod_i</span>, <span class="va">stim_i</span>, 
         <span class="va">mod_version_slope</span>, <span class="va">stim_version_slope</span>, 
         <span class="va">mod_cond_slope</span>, <span class="va">stim_cond_slope</span>, 
         <span class="va">mod_cond_version_slope</span>, <span class="va">stim_cond_version_slope</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/faux/man/get_params.html" class="external-link">get_params</a></span><span class="op">(</span><span class="op">)</span>    <span class="co"># calculates means, SDs and correlations</span>

<span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="va">x</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">var</span>, levels <span class="op">=</span> <span class="va">nm</span><span class="op">)</span>
<span class="va">x</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mod_v <span class="op">=</span> <span class="fl">5</span>, stim_v <span class="op">=</span> <span class="fl">6</span>, 
         mod_c <span class="op">=</span> <span class="fl">7</span>, stim_c <span class="op">=</span> <span class="fl">8</span>, 
         mod_cv <span class="op">=</span> <span class="fl">9</span>, stim_cv <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># rename columns to fit width</span>
<span class="co">##    n                     var mod_i stim_i mod_v stim_v mod_c stim_c mod_cv</span>
<span class="co">## 1 50                   mod_i  1.00   1.00 -0.50  -0.49 -0.08  -0.07  -0.35</span>
<span class="co">## 2 50                  stim_i  1.00   1.00 -0.49  -0.49 -0.08  -0.07  -0.34</span>
<span class="co">## 3 50       mod_version_slope -0.50  -0.49  1.00   0.97 -0.02  -0.03   0.32</span>
<span class="co">## 4 50      stim_version_slope -0.49  -0.49  0.97   1.00 -0.07  -0.06   0.29</span>
<span class="co">## 5 50          mod_cond_slope -0.08  -0.08 -0.02  -0.07  1.00   1.00  -0.04</span>
<span class="co">## 6 50         stim_cond_slope -0.07  -0.07 -0.03  -0.06  1.00   1.00  -0.03</span>
<span class="co">## 7 50  mod_cond_version_slope -0.35  -0.34  0.32   0.29 -0.04  -0.03   1.00</span>
<span class="co">## 8 50 stim_cond_version_slope -0.35  -0.35  0.30   0.30 -0.07  -0.07   0.94</span>
<span class="co">##   stim_cv  mean    sd</span>
<span class="co">## 1   -0.35  0.00 44.90</span>
<span class="co">## 2   -0.35  8.14 44.95</span>
<span class="co">## 3    0.30  0.00  9.14</span>
<span class="co">## 4    0.30 -0.58  9.65</span>
<span class="co">## 5   -0.07  0.00 25.95</span>
<span class="co">## 6   -0.07 -0.69 25.71</span>
<span class="co">## 7    0.94  0.00 13.11</span>
<span class="co">## 8    1.00  0.99 13.76</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="function-1">Function<a class="anchor" aria-label="anchor" href="#function-1"></a>
</h2>
<p>You can put the code above in a function so you can run it more
easily and change the parameters. I removed the plot and set the
argument defaults to the same as the example above, but you can set them
to other patterns.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_lmer_slope</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">sub_n</span> <span class="op">=</span> <span class="fl">200</span>,
                            <span class="va">sub_sd</span> <span class="op">=</span> <span class="fl">100</span>,
                            <span class="va">sub_version_sd</span> <span class="op">=</span> <span class="fl">20</span>, 
                            <span class="va">sub_i_version_cor</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>,
                            <span class="va">stim_n</span> <span class="op">=</span> <span class="fl">50</span>,
                            <span class="va">stim_sd</span> <span class="op">=</span> <span class="fl">50</span>,
                            <span class="va">stim_version_sd</span> <span class="op">=</span> <span class="fl">10</span>,
                            <span class="va">stim_cond_sd</span> <span class="op">=</span> <span class="fl">30</span>,
                            <span class="va">stim_cond_version_sd</span> <span class="op">=</span> <span class="fl">15</span>,
                            <span class="va">stim_i_cor</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span>,
                            <span class="va">stim_s_cor</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.2</span>,
                            <span class="va">grand_i</span> <span class="op">=</span> <span class="fl">400</span>,
                            <span class="va">sub_cond_eff</span> <span class="op">=</span> <span class="fl">0</span>,
                            <span class="va">stim_version_eff</span> <span class="op">=</span> <span class="fl">0</span>, 
                            <span class="va">cond_version_ixn</span> <span class="op">=</span> <span class="fl">0</span>,
                            <span class="va">error_sd</span> <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/rnorm_multi.html" class="external-link">rnorm_multi</a></span><span class="op">(</span>
    n <span class="op">=</span> <span class="va">sub_n</span>, 
    mu <span class="op">=</span> <span class="fl">0</span>, <span class="co"># means of random intercepts and slopes are always 0</span>
    sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sub_sd</span>, <span class="va">sub_version_sd</span><span class="op">)</span>,
    r <span class="op">=</span> <span class="va">sub_i_version_cor</span>,
    varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sub_i"</span>, <span class="st">"sub_version_slope"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      sub_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">sub_n</span>,
      sub_cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"hard"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sub_n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="co"># between-subjects factor</span>
    <span class="op">)</span>
  
  <span class="va">stim_cors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>, <span class="va">stim_i_cor</span>,
                             <span class="va">stim_s_cor</span>, <span class="va">stim_s_cor</span>,
                                         <span class="va">stim_s_cor</span><span class="op">)</span>
  <span class="va">stim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/faux/man/rnorm_multi.html" class="external-link">rnorm_multi</a></span><span class="op">(</span>
    n <span class="op">=</span> <span class="va">stim_n</span>,
    mu <span class="op">=</span> <span class="fl">0</span>, <span class="co"># means of random intercepts and slopes are always 0</span>
    sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_sd</span>, <span class="va">stim_version_sd</span>, <span class="va">stim_cond_sd</span>, <span class="va">stim_cond_version_sd</span><span class="op">)</span>,
    r <span class="op">=</span> <span class="va">stim_cors</span>, 
    varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stim_i"</span>, <span class="st">"stim_version_slope"</span>, <span class="st">"stim_cond_slope"</span>, <span class="st">"stim_cond_version_slope"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      stim_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">stim_n</span>
    <span class="op">)</span>
  
  <span class="va">trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>
    sub_id <span class="op">=</span> <span class="va">sub</span><span class="op">$</span><span class="va">sub_id</span>, <span class="co"># get subject IDs from the sub data table</span>
    stim_id <span class="op">=</span> <span class="va">stim</span><span class="op">$</span><span class="va">stim_id</span>, <span class="co"># get stimulus IDs from the stim data table</span>
    stim_version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span> <span class="co"># all subjects see both congruent and incongruent versions of all stimuli</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sub</span>, by <span class="op">=</span> <span class="st">"sub_id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># includes the intercept, slope, and conditin for each subject</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stim</span>, by <span class="op">=</span> <span class="st">"stim_id"</span><span class="op">)</span>   <span class="co"># includes the intercept and slopes for each stimulus</span>
  
  <span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"hard"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
  <span class="va">versions</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"incongruent"</span> <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>
  
  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">trials</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      <span class="co"># effect-code subject condition and stimulus version</span>
      sub_cond.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">sub_cond</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">conditions</span><span class="op">)</span>,
      stim_version.e <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">stim_version</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">versions</span><span class="op">)</span>,
      <span class="co"># calculate trial-specific effects by adding overall effects and slopes</span>
      cond_eff <span class="op">=</span> <span class="va">sub_cond_eff</span> <span class="op">+</span> <span class="va">stim_cond_slope</span>,
      version_eff <span class="op">=</span> <span class="va">stim_version_eff</span> <span class="op">+</span> <span class="va">stim_version_slope</span> <span class="op">+</span> <span class="va">sub_version_slope</span>,
      cond_version_eff <span class="op">=</span> <span class="va">cond_version_ixn</span> <span class="op">+</span> <span class="va">stim_cond_version_slope</span>,
      <span class="co"># calculate error term (normally distributed residual with SD set above)</span>
      err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">error_sd</span><span class="op">)</span>,
      <span class="co"># calculate DV from intercepts, effects, and error</span>
      dv <span class="op">=</span> <span class="va">grand_i</span> <span class="op">+</span> <span class="va">sub_i</span> <span class="op">+</span> <span class="va">stim_i</span> <span class="op">+</span> <span class="va">err</span> <span class="op">+</span>
           <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">cond_eff</span><span class="op">)</span> <span class="op">+</span> 
           <span class="op">(</span><span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">version_eff</span><span class="op">)</span> <span class="op">+</span> 
           <span class="op">(</span><span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">*</span> <span class="va">cond_version_eff</span><span class="op">)</span>
    <span class="op">)</span>
  
  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmerTest/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">sub_cond.e</span> <span class="op">*</span> <span class="va">stim_version.e</span> <span class="op">+</span>
                <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">stim_version.e</span> <span class="op">||</span> <span class="va">sub_id</span><span class="op">)</span> <span class="op">+</span> 
                <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">stim_version.e</span><span class="op">*</span><span class="va">sub_cond.e</span> <span class="op">||</span> <span class="va">stim_id</span><span class="op">)</span>,
              data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Run the function with the default values (null fixed effects).</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">sim_lmer_slope</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/faux/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span>
<span class="co">## lmerModLmerTest]</span>
<span class="co">## Formula: dv ~ sub_cond.e * stim_version.e + (1 + stim_version.e || sub_id) +  </span>
<span class="co">##     (1 + stim_version.e * sub_cond.e || stim_id)</span>
<span class="co">##    Data: dat</span>
<span class="co">## </span>
<span class="co">## REML criterion at convergence: 188361</span>
<span class="co">## </span>
<span class="co">## Scaled residuals: </span>
<span class="co">##    Min     1Q Median     3Q    Max </span>
<span class="co">## -3.626 -0.673  0.003  0.670  3.860 </span>
<span class="co">## </span>
<span class="co">## Random effects:</span>
<span class="co">##  Groups    Name                      Variance Std.Dev.</span>
<span class="co">##  sub_id    (Intercept)               9833.2   99.2    </span>
<span class="co">##  sub_id.1  stim_version.e             412.8   20.3    </span>
<span class="co">##  stim_id   (Intercept)               2028.7   45.0    </span>
<span class="co">##  stim_id.1 stim_version.e              90.3    9.5    </span>
<span class="co">##  stim_id.2 sub_cond.e                 682.9   26.1    </span>
<span class="co">##  stim_id.3 stim_version.e:sub_cond.e  203.1   14.3    </span>
<span class="co">##  Residual                             625.1   25.0    </span>
<span class="co">## Number of obs: 20000, groups:  sub_id, 200; stim_id, 50</span>
<span class="co">## </span>
<span class="co">## Fixed effects:</span>
<span class="co">##                           Estimate Std. Error     df t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)                 399.29       9.47 175.66   42.14   &lt;2e-16 ***</span>
<span class="co">## sub_cond.e                    1.97      14.51 222.03    0.14     0.89    </span>
<span class="co">## stim_version.e               -2.30       2.00 159.16   -1.15     0.25    </span>
<span class="co">## sub_cond.e:stim_version.e    -3.48       3.58 202.35   -0.97     0.33    </span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Correlation of Fixed Effects:</span>
<span class="co">##             (Intr) sb_cn. stm_v.</span>
<span class="co">## sub_cond.e  0.000               </span>
<span class="co">## stim_versn. 0.000  0.000        </span>
<span class="co">## sb_cnd.:s_. 0.000  0.000  0.000</span></code></pre></div>
<p>Try changing some variables to simulate fixed effects.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">sim_lmer_slope</span><span class="op">(</span>sub_cond_eff <span class="op">=</span> <span class="fl">50</span>,
               stim_version_eff <span class="op">=</span> <span class="fl">50</span>, 
               cond_version_ixn <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">## Linear mixed model fit by REML ['lmerModLmerTest']</span>
<span class="co">## Formula: dv ~ sub_cond.e * stim_version.e + (1 + stim_version.e || sub_id) +  </span>
<span class="co">##     (1 + stim_version.e * sub_cond.e || stim_id)</span>
<span class="co">##    Data: dat</span>
<span class="co">## REML criterion at convergence: 188427</span>
<span class="co">## Random effects:</span>
<span class="co">##  Groups    Name                      Std.Dev.</span>
<span class="co">##  sub_id    (Intercept)               94.36   </span>
<span class="co">##  sub_id.1  stim_version.e            19.19   </span>
<span class="co">##  stim_id   (Intercept)               43.57   </span>
<span class="co">##  stim_id.1 stim_version.e             8.43   </span>
<span class="co">##  stim_id.2 sub_cond.e                33.13   </span>
<span class="co">##  stim_id.3 stim_version.e:sub_cond.e 13.59   </span>
<span class="co">##  Residual                            25.07   </span>
<span class="co">## Number of obs: 20000, groups:  sub_id, 200; stim_id, 50</span>
<span class="co">## Fixed Effects:</span>
<span class="co">##               (Intercept)                 sub_cond.e  </span>
<span class="co">##                    404.26                      51.13  </span>
<span class="co">##            stim_version.e  sub_cond.e:stim_version.e  </span>
<span class="co">##                     50.86                       5.72</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercises">Exercises<a class="anchor" aria-label="anchor" href="#exercises"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Calculate power for the parameters in the last example using the
<code>sim_lmer_slope()</code> function.</p></li>
<li><p>Simulate data for the following design:</p></li>
</ol>
<ul>
<li>100 raters rate 50 faces from group A and 50 faces from group B</li>
<li>The DV is a rating on a 0-100 scale with a mean value of 50</li>
<li>Rater intercepts have an SD of 5</li>
<li>Face intercepts have an SD of 10</li>
<li>The residual error has an SD of 8</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>For the design from exercise 2, write a function that simulates
data and runs a mixed effects analysis on it.</p></li>
<li><p>The package <code>faux</code> has a built-in dataset called
<code>fr4</code>. Type <code><a href="https://rdrr.io/pkg/faux/man/fr4.html" class="external-link">?faux::fr4</a></code> into the console to view
the help for this dataset. Run a mixed effects model on this dataset
looking at the effect of <code>face_sex</code> on ratings. Rememnber to
include a random slope for the effect of face sex.</p></li>
<li><p>Use the parameters from this analysis to simulate a new dataset
with 50 male and 50 female faces, and 100 raters.</p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lisa DeBruine.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
