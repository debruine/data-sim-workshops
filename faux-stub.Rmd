---
title: "Intro to faux: Stub"
output: html_document
---

```{r, include=FALSE}
library(tidyverse)
# devtools::install_github("debruine/faux", build_vignettes = FALSE)
library(faux)
options(scipen = 999)
```

## Simulate Data with faux

```{r}
dat3 <- rnorm_multi(n = 100, 
                    vars = 4, 
                    mu = c(100, 150, 200, 250),
                    sd = c(10, 11, 12, 13),
                    r = c(.5, .7, .2,
                              .5, .3,
                                   0),
                    varnames = c("A", "B", "C", "D")
                    )

cor(dat3)
```

```{r}

mu <- data.frame(
  pre = c(10, 20),
  post = c(30, 40)
)

rownames(mu) <- c("cat", "dog")
  

simdat <- sim_design(
  within = list(time = c("pre", "post")),
  between = list(pet = c("cat", "dog")),
  mu = mu,
  long = TRUE
)
```

## Paired-samples design

```{r}

dat <- sim_design(
  n = 25,
  within = list(time = c("pre", "post")),
  mu = c(100, 105),
  sd = 10,
  r = 0.5,
  long = TRUE,
  dv = "score"
)

```

## Check the simulated data

```{r}
check_sim_stats(dat, within = "time")
```

## Analyse

```{r}
tt <- t.test(score ~ time, data = dat, paired = TRUE)

tt$p.value
```

## Power simulation

```{r}
dat100 <- sim_design(
  n = 25,
  within = list(time = c("pre", "post")),
  mu = c(100, 105),
  sd = 10,
  r = 0.5,
  long = TRUE,
  dv = "score",
  rep = 100,
  plot = FALSE
)
```


```{r}

p <- map_dbl(dat100$data, ~t.test(score ~ time, data = ., paired = TRUE)$p.value)

```

```{r}
hist(p)

mean(p < .01)
```

## Sensitivity

```{r}
nlist <- seq(25, 100, 5)
power <- c()

for (i in 1:length(nlist)) {
  dat100 <- sim_design(
    n = nlist[i],
    within = list(time = c("pre", "post")),
    mu = c(100, 105),
    sd = 10,
    r = 0.5,
    long = TRUE,
    dv = "score",
    rep = 100,
    plot = FALSE
  )
  
  p <- map_dbl(dat100$data, ~t.test(score ~ time, data = ., paired = TRUE)$p.value)
  
  power[i] <- mean(p < .05)
}


ggplot() +
  geom_point(aes(nlist, power))
```

## Exercises


### 2b

Create a dataset with a between-subject factor of "pet" having two levels, "cat", and "dog". The DV is "happiness" score. There are 20 cat-owners with a mean happiness score of 10 (SD = 3) and there are 30 dog-owners with a mean happiness score of 11 (SD = 3).

```{r}
dat2b <- NULL
```

### 3w

Create a dataset with 1 within-subject variable ("condition") having 3 levels ("A", "B", "C") with means of 1, 2 and 3 and SD of 5. The correlations between each level have r = 0.4.  

```{r}

dat3w <- NULL

```

### 2w*2w

Create a dataset with 2 within-subject variables ("A" and "B") each having 2 levels. The mean for all cells is 10 and the SD is 2. The dataset should have 20 subjects. The correlations look like this:

|       | A1_B1 | A1_B2 | A2_B1 | A2_B2 |
|:------|------:|------:|------:|------:|
| A1_B1 | 1.0   | 0.5   | 0.5   | 0.2   |
| A1_B2 | 0.5   | 1.0   | 0.2   | 0.5   |
| A2_B1 | 0.5   | 0.2   | 1.0   | 0.5   |
| A2_B2 | 0.2   | 0.5   | 0.5   | 1.0   |


```{r}
dat2w2w <- NULL
```

### 2w*3b

Create a dataset with a between-subject factor of "pet" having 3 levels ("cat", "dog", and "ferret") and a within-subject factor of "time" having 2 levels ("pre" and "post"). The N in each group should be 10. Means are:

* cats: pre = 10, post = 12
* dogs: pre = 14, post = 16
* ferretts: pre = 18, post = 20

SDs are all 5 and within-cell correlations are all 0.25.

```{r}

dat2w3b <- NULL
  
```

### Replications

Create 5 datasets with a 2b*2b design, 30 participants in each cell. Each cell's mean should be 0, except A1_B1, which should be 0.5. The SD should be 1. Make the resulting data in long format. Plot the data using `plot_design` (try setting the `geoms` argument, options are "pointrangeSD", "pointrangeSE", "violin", "box", "jitter").

```{r}
dat2b2b <- NULL
```


### Power

The function `sim_aov` returns a table of results for an ANOVA. Using the design from the last question and 100 reps, calculate power. (Hint: use the `map_df` function)

```{r}
sim_aov <- function(dat) {
  aov(y ~ A * B, dat) %>% 
    broom::tidy()
}

```

### False Positives

Repeat the last exercise with null results to calculate the false positive rate. Use 1000 reps.

```{r}
dat2b2bnull <- NULL

```

